{"version":3,"file":"jgoboard.js","sources":["../JGO/coordinate.js","../JGO/util.js","../JGO/constants.js","../JGO/stones.js","../JGO/canvas.js","../JGO/node.js","../JGO/notifier.js","../JGO/board.js","../JGO/record.js","../JGO/setup.js","../JGO/sgf.js","../JGO/auto.js","../JGO/index.js","../main.js"],"sourcesContent":["const SGFLetters = 'abcdefghijklmnopqrstuvwxyz'.split('');\n\n/**\n * Create a helper class to create coordinates from (1,2) (zero-based),\n * 'ah' type of input. You can create a coordinate with no arguments, in\n * which case it defaults to (0,0), or with one argument, in which case it\n * tries to parse 'ai' type of string coordinate, or with two arguments, (i,j).\n * 'J18' style coordinates depend on board size due to number running from\n * bottom, so those need to be instantiated from Board.getCoordinate.\n *\n * @param {int} [i] Column or SGF-style string.\n * @param {int} [j] Row.\n * @constructor\n */\nconst Coordinate = function(i, j) {\n  if(i !== undefined) {\n    if(j !== undefined) {\n      this.i = i;\n      this.j = j;\n    } else { // try to parse coordinates from first parameter\n      this.i = 0;\n      this.j = 0;\n\n      if(typeof i != 'string')\n        return;\n\n      // assume SGF-type coordinate\n      i = i.toLowerCase();\n\n      this.i = SGFLetters.indexOf(i.substr(0,1));\n      this.j = SGFLetters.indexOf(i.substr(1));\n    }\n  } else { // called without both parameters\n    this.i = 0;\n    this.j = 0;\n  }\n};\n\n/**\n * Compare with another coordinate.\n *\n * @param {Coordinate} Coordinate.\n * @returns {boolean} true if equal, false if not.\n */\nCoordinate.prototype.equals = function(c) {\n  return (c.i == this.i) && (c.j == this.j);\n};\n\n/**\n * Make an SGF-type 'ai' string representation of the coordinate.\n *\n * @returns {string} String representation.\n */\nCoordinate.prototype.toString = function() {\n  return SGFLetters[this.i] + SGFLetters[this.j];\n};\n\n/**\n * Make a copy of this coordinate.\n *\n * @returns {Coordinate} A copy of this coordinate.\n */\nCoordinate.prototype.copy = function() {\n  return new Coordinate(this.i, this.j);\n};\n\nexport default Coordinate;\n","/**\n * Utility function module.\n * @module util\n */\n\nimport Coordinate from './coordinate.js';\n\n/**\n * Load images and defined by object and invoke callback when completed.\n *\n * @param {Object} sources A dictionary of sources to load.\n * @param {function} callback A callback function to call with image dict.\n */\nexport function loadImages(sources, callback) {\n  var images = {}, imagesLeft = 0;\n\n  for(var src in sources) // count non-false properties as images\n    if(sources.hasOwnProperty(src) && sources[src])\n      imagesLeft++;\n\n  var countdown = function() {\n    if(--imagesLeft <= 0) {\n      callback(images);\n    }\n  };\n\n  for(src in sources) { // load non-false properties to images object\n    if(sources.hasOwnProperty(src) && sources[src]) {\n      /* global Image */\n      images[src] = new Image();\n      images[src].onload = countdown;\n      images[src].src = sources[src];\n    }\n  }\n};\n\n/**\n * Helper function to create coordinates for standard handicap placement.\n *\n * @param {int} size Board size (9, 13, 19 supported).\n * @param {itn} num Number of handicap stones.\n * @returns {Array} Array of Coordinate objects.\n */\nexport function getHandicapCoordinates(size, num) {\n  // Telephone dial style numbering\n  var handicapPlaces = [[], [], [3,7], [3,7,9], [1,3,7,9], [1,3,5,7,9],\n      [1,3,4,6,7,9], [1,3,4,5,6,7,9], [1,2,3,4,6,7,8,9],\n      [1,2,3,4,5,6,7,8,9]];\n  var places = handicapPlaces[num], offset = (size <= 9 ? 2 : 3),\n      step = (size - 1) / 2 - offset, coords = [];\n\n  if(places) {\n    for(var n=0; n<places.length; n++) {\n      var i = (places[n]-1) % 3, j = Math.floor((places[n]-1) / 3);\n      coords.push(new Coordinate(offset+i*step, offset+j*step));\n    }\n  }\n\n  return coords;\n};\n\n/**\n * Deep extend an object.\n *\n * @function extend\n * @param {Object} dest Destination object to extend.\n * @param {Object} src Source object which properties will be copied.\n * @returns {Object} Extended destination object.\n */\nexport function extend(dest, src) {\n  for(var key in src) {\n    if(src.hasOwnProperty(key)) {\n      if(typeof src[key] === 'object') {\n        if(!dest[key] || (typeof dest[key] !== 'object'))\n          dest[key] = {}; // create/overwrite if necessary\n        extend(dest[key], src[key]);\n      } else dest[key] = src[key];\n    }\n  }\n\n  return dest;\n}\n","import { extend } from './util.js';\n\n/**\n * Enum for intersection types. Aliased in JGO namespace, e.g. JGO.BLACK.\n * @enum\n * @readonly\n */\nexport const INTERSECTION = {\n  CLEAR: 0,\n  /** Black stone */\n  BLACK: 1,\n  /** White stone */\n  WHITE: 2,\n  /** Semi-transparent black stone */\n  DIM_BLACK: 3,\n  /** Semi-transparent white stone */\n  DIM_WHITE: 4\n};\n\n/**\n * Enum for marker types.\n * @readonly\n * @enum\n */\nexport const MARK = {\n  /** No marker ('') */\n  NONE: '',\n  /** Selected intersection */\n  SELECTED: '^',\n  /** Square */\n  SQUARE: '#',\n  /** Triangle */\n  TRIANGLE: '/',\n  /** Circle */\n  CIRCLE: '0',\n  /** Cross */\n  CROSS: '*',\n  /** Black territory */\n  BLACK_TERRITORY: '-',\n  /** White territory */\n  WHITE_TERRITORY: '+'\n};\n\n/**\n * Board coordinate array.\n * @constant\n */\nexport const COORDINATES = 'ABCDEFGHJKLMNOPQRSTUVWXYZ'.split('');\n\n// Create the base JGO object with all exports\nconst JGO = {\n  INTERSECTION,\n  MARK,\n  COORDINATES\n};\n\n// Alias all INTERSECTION properties into globals (for backward compatibility)\nextend(JGO, INTERSECTION);\n\nexport default JGO;\n","import C from './constants.js';\n\n/**\n * Create a jGoBoard stones object. This is a facility that can draw\n * stones and markers on a HTML5 canvas. Only used internally by the\n * library.\n *\n * @param {Object} options Options array.\n * @constructor\n */\nvar Stones = function(options, images) {\n  this.stoneR = options.stone.radius;\n  this.gridX = options.grid.x;\n  this.gridY = options.grid.x;\n  this.markX = this.stoneR * 1.1;\n  this.markY = this.stoneR * 1.1;\n  this.circleR = this.stoneR * 0.5;\n  this.triangleR = this.stoneR * 0.9;\n  this.images = images;\n};\n\nStones.prototype.drawStone = function(ctx, type, ox, oy, scale) {\n  if(!scale) scale = 1;\n  var stone = (type == C.BLACK || type == C.DIM_BLACK) ? this.images.black : this.images.white;\n\n  if(!stone) { // BW\n    ctx.fillStyle = (type == C.WHITE) ? '#FFFFFF' : '#000000';\n    ctx.beginPath();\n    ctx.arc(ox, oy, this.stoneR*scale, 2*Math.PI, false);\n    ctx.fill();\n\n    if(type == C.WHITE) {\n      ctx.strokeStyle = '#000000';\n      ctx.stroke();\n    }\n  } else {\n    // round x, y for crisp rendering\n    ctx.drawImage(stone, 0, 0, stone.width, stone.height,\n        Math.round(ox - stone.width / 2 * scale),\n        Math.round(oy - stone.height / 2 * scale),\n        stone.width * scale, stone.height * scale);\n  }\n};\n\nStones.prototype.drawShadow = function(ctx, ox, oy, scale) {\n  var shadow = this.images.shadow;\n  if(!shadow) return;\n  if(!scale) scale = 1;\n\n  ctx.drawImage(shadow, 0, 0, shadow.width, shadow.height,\n      Math.round(ox - shadow.width / 2 * scale),\n      Math.round(oy - shadow.height / 2 * scale),\n      shadow.width * scale, shadow.height * scale);\n};\n\nStones.prototype.drawMark = function(ctx, mark, ox, oy) {\n  switch(mark) {\n    case C.MARK.SQUARE:\n      ctx.beginPath();\n      ctx.rect(ox - this.markX / 2, oy - this.markY / 2, this.markX, this.markY);\n      ctx.stroke();\n      break;\n\n    case C.MARK.CROSS:\n      ctx.beginPath();\n      ctx.moveTo(ox - this.markX / 2, oy + this.markY / 2);\n      ctx.lineTo(ox + this.markX / 2, oy - this.markY / 2);\n      ctx.moveTo(ox - this.markX / 2, oy - this.markY / 2);\n      ctx.lineTo(ox + this.markX / 2, oy + this.markY / 2);\n      ctx.stroke();\n      break;\n\n    case C.MARK.TRIANGLE:\n      ctx.beginPath();\n      for(var r=0; r<3; r++) {\n        ctx.moveTo(ox + this.triangleR * Math.cos(Math.PI * (0.5 + 2*r/3)),\n            oy - this.triangleR * Math.sin(Math.PI * (0.5 + 2*r/3)));\n        ctx.lineTo(ox + this.triangleR * Math.cos(Math.PI * (0.5 + 2*(r+1)/3)),\n            oy - this.triangleR * Math.sin(Math.PI * (0.5 + 2*(r+1)/3)));\n      }\n      ctx.stroke();\n      break;\n\n    case C.MARK.CIRCLE:\n      ctx.beginPath();\n      ctx.arc(ox, oy, this.circleR, 2*Math.PI, false);\n      ctx.stroke();\n      break;\n\n    case C.MARK.BLACK_TERRITORY:\n      ctx.globalAlpha=1;\n      this.drawStone(ctx, C.BLACK, ox, oy, 0.5);\n      break;\n\n    case C.MARK.WHITE_TERRITORY:\n      ctx.globalAlpha=1;\n      this.drawStone(ctx, C.WHITE, ox, oy, 0.5);\n      break;\n\n    case C.MARK.SELECTED:\n      ctx.globalAlpha=0.5;\n      ctx.fillStyle = '#8080FF';\n      //ctx.beginPath();\n      ctx.fillRect(ox - this.gridX / 2, oy - this.gridY / 2,\n          this.gridX, this.gridY);\n      break;\n\n    default: // Label\n      // For clear intersections, grid is cleared before shadow cast\n      ctx.fillText(mark, ox, oy);\n      break;\n  }\n};\n\nexport default Stones;\n","import C from './constants.js';\nimport Coordinate from './coordinate.js';\nimport Stones from './stones.js';\nimport * as util from './util.js';\n\n/**\n * Create a jGoBoard canvas object.\n *\n * @param {Object} elem Container HTML element or its id.\n * @param {Object} opt Options object.\n * @param {Object} images Set of images (or false values) for drawing.\n * @constructor\n */\nvar Canvas = function(elem, opt, images) {\n  /* global document */\n  if(typeof elem === 'string')\n    elem = document.getElementById(elem);\n\n  var canvas = document.createElement('canvas'), i, j;\n\n  var padLeft = opt.edge.left ? opt.padding.normal : opt.padding.clipped,\n      padRight = opt.edge.right ? opt.padding.normal : opt.padding.clipped,\n      padTop = opt.edge.top ? opt.padding.normal : opt.padding.clipped,\n      padBottom = opt.edge.bottom ? opt.padding.normal : opt.padding.clipped;\n\n  this.marginLeft = opt.edge.left ? opt.margin.normal : opt.margin.clipped;\n  this.marginRight = opt.edge.right ? opt.margin.normal : opt.margin.clipped;\n  this.marginTop = opt.edge.top ? opt.margin.normal : opt.margin.clipped;\n  this.marginBottom = opt.edge.bottom ? opt.margin.normal : opt.margin.clipped;\n\n  this.boardWidth = padLeft + padRight +\n    opt.grid.x * opt.view.width;\n  this.boardHeight = padTop + padBottom +\n    opt.grid.y * opt.view.height;\n\n  this.width = canvas.width =\n    this.marginLeft + this.marginRight + this.boardWidth;\n  this.height = canvas.height =\n    this.marginTop + this.marginBottom + this.boardHeight;\n\n  this.listeners = {'click': [], 'mousemove': [], 'mouseout': []};\n\n  /**\n   * Get board coordinate based on screen coordinates.\n   * @param {number} x Coordinate.\n   * @param {number} y Coordinate.\n   * @returns {Coordinate} Board coordinate.\n   */\n  this.getCoordinate = function(pageX, pageY) {\n    var bounds = canvas.getBoundingClientRect(),\n        scaledX = (pageX - bounds.left) * canvas.width / (bounds.right - bounds.left),\n        scaledY = (pageY - bounds.top) * canvas.height / (bounds.bottom - bounds.top);\n\n    return new Coordinate(\n        Math.floor((scaledX-this.marginLeft-padLeft)/opt.grid.x) + opt.view.xOffset,\n        Math.floor((scaledY-this.marginTop-padTop)/opt.grid.y) + opt.view.yOffset);\n  }.bind(this);\n\n  // Click handler will call all listeners passing the coordinate of click\n  // and the click event\n  canvas.onclick = function(ev) {\n    var c = this.getCoordinate(ev.clientX, ev.clientY),\n        listeners = this.listeners.click;\n\n    for(var l=0; l<listeners.length; l++)\n      listeners[l].call(this, c.copy(), ev);\n  }.bind(this);\n\n  var lastMove = new Coordinate(-1,-1);\n\n  // Move handler will call all listeners passing the coordinate of move\n  // whenever mouse moves over a new intersection\n  canvas.onmousemove = function(ev) {\n    if(!this.listeners.mousemove.length) return;\n\n    var c = this.getCoordinate(ev.clientX, ev.clientY),\n        listeners = this.listeners.mousemove;\n\n    if(c.i < this.opt.view.xOffset ||\n        c.i >= this.opt.view.xOffset + this.opt.view.width)\n      c.i = -1;\n\n    if(c.j < this.opt.view.yOffset ||\n        c.j >= this.opt.view.yOffset + this.opt.view.height)\n      c.j = -1;\n\n    if(lastMove.equals(c))\n      return; // no change\n    else\n      lastMove = c.copy();\n\n    for(var l=0; l<listeners.length; l++)\n      listeners[l].call(this, c.copy(), ev);\n  }.bind(this);\n\n  // Mouseout handler will again call all listeners of that event, no\n  // coordinates will be passed of course, only the event\n  canvas.onmouseout = function(ev) {\n    var listeners = this.listeners.mouseout;\n\n    for(var l=0; l<listeners.length; l++)\n      listeners[l].call(this, ev);\n  }.bind(this);\n\n  elem.appendChild(canvas);\n\n  this.ctx = canvas.getContext('2d');\n  this.opt = util.extend({}, opt); // make a copy just in case\n  this.stones = new Stones(opt, images);\n  this.images = images;\n\n  // Fill margin with correct color\n  this.ctx.fillStyle = opt.margin.color;\n  this.ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  if(this.images.board) {\n    // Prepare to draw board with shadow\n    this.ctx.save();\n    this.ctx.shadowColor = opt.boardShadow.color;\n    this.ctx.shadowBlur = opt.boardShadow.blur;\n    this.ctx.shadowOffsetX = opt.boardShadow.offX;\n    this.ctx.shadowOffsetX = opt.boardShadow.offY;\n\n    var clipTop = opt.edge.top ? 0 : this.marginTop,\n        clipLeft = opt.edge.left ? 0 : this.marginLeft,\n        clipBottom = opt.edge.bottom ? 0 : this.marginBottom,\n        clipRight = opt.edge.right ? 0 : this.marginRight;\n\n    // Set clipping to throw shadow only on actual edges\n    this.ctx.beginPath();\n    this.ctx.rect(clipLeft, clipTop,\n        canvas.width - clipLeft - clipRight,\n        canvas.height - clipTop - clipBottom);\n    this.ctx.clip();\n\n    this.ctx.drawImage(this.images.board, 0, 0,\n        this.boardWidth, this.boardHeight,\n        this.marginLeft, this.marginTop,\n        this.boardWidth, this.boardHeight);\n\n    // Draw lighter border around the board to make it more photography\n    this.ctx.strokeStyle = opt.border.color;\n    this.ctx.lineWidth = opt.border.lineWidth;\n    this.ctx.beginPath();\n    this.ctx.rect(this.marginLeft, this.marginTop,\n        this.boardWidth, this.boardHeight);\n    this.ctx.stroke();\n\n    this.ctx.restore(); // forget shadow and clipping\n  }\n\n  // Top left center of grid (not edge, center!)\n  this.gridTop = this.marginTop + padTop + opt.grid.y / 2;\n  this.gridLeft = this.marginLeft + padLeft + opt.grid.x / 2;\n\n  this.ctx.strokeStyle = opt.grid.color;\n\n  var smt = this.opt.grid.smooth; // with 0.5 there will be full antialias\n\n  // Draw vertical gridlines\n  for(i=0; i<opt.view.width; i++) {\n    if((i === 0 && opt.edge.left) || (i+1 == opt.view.width && opt.edge.right))\n      this.ctx.lineWidth = opt.grid.borderWidth;\n    else\n      this.ctx.lineWidth = opt.grid.lineWidth;\n\n    this.ctx.beginPath();\n\n    this.ctx.moveTo(smt + this.gridLeft + opt.grid.x * i,\n        smt + this.gridTop - (opt.edge.top ? 0 : opt.grid.y / 2 + padTop/2));\n    this.ctx.lineTo(smt + this.gridLeft + opt.grid.x * i,\n        smt + this.gridTop + opt.grid.y * (opt.view.height - 1) +\n        (opt.edge.bottom ? 0 : opt.grid.y / 2 + padBottom/2));\n    this.ctx.stroke();\n  }\n\n  // Draw horizontal gridlines\n  for(i=0; i<opt.view.height; i++) {\n    if((i === 0 && opt.edge.top) || (i+1 == opt.view.height && opt.edge.bottom))\n      this.ctx.lineWidth = opt.grid.borderWidth;\n    else\n      this.ctx.lineWidth = opt.grid.lineWidth;\n\n    this.ctx.beginPath();\n\n    this.ctx.moveTo(smt + this.gridLeft - (opt.edge.left ? 0 : opt.grid.x / 2 + padLeft/2),\n        smt + this.gridTop + opt.grid.y * i);\n    this.ctx.lineTo(smt + this.gridLeft + opt.grid.x * (opt.view.width - 1) +\n        (opt.edge.right ? 0 : opt.grid.x / 2 + padRight/2),\n        smt + this.gridTop + opt.grid.y * i);\n    this.ctx.stroke();\n  }\n\n  if(opt.stars.points) { // If star points\n    var step = (opt.board.width - 1) / 2 - opt.stars.offset;\n    // 1, 4, 5, 8 and 9 points are supported, rest will result in randomness\n    for(j=0; j<3; j++) {\n      for(i=0; i<3; i++) {\n        if(j == 1 && i == 1) { // center\n          if(opt.stars.points % 2 === 0)\n            continue; // skip center\n        } else if(i == 1 || j == 1) { // non-corners\n          if(opt.stars.points < 8)\n            continue; // skip non-corners\n        } else { // corners\n          if(opt.stars.points < 4)\n            continue; // skip corners\n        }\n\n        var x = (opt.stars.offset + i * step) - opt.view.xOffset,\n            y = (opt.stars.offset + j * step) - opt.view.yOffset;\n\n        if(x < 0 || y < 0 || x >= opt.view.width || y >= opt.view.height)\n          continue; // invisible\n\n        this.ctx.beginPath();\n        this.ctx.arc(smt + this.gridLeft + x * opt.grid.x,\n            smt + this.gridTop + y * opt.grid.y,\n            opt.stars.radius, 2*Math.PI, false);\n        this.ctx.fillStyle = opt.grid.color;\n        this.ctx.fill();\n      }\n    }\n  }\n\n  this.ctx.font = opt.coordinates.font;\n  this.ctx.fillStyle = opt.coordinates.color;\n  this.ctx.textAlign = 'center';\n  this.ctx.textBaseline = 'middle';\n\n  // Draw horizontal coordinates\n  for(i=0; i<opt.view.width; i++) {\n    if(opt.coordinates && opt.coordinates.top)\n      this.ctx.fillText(C.COORDINATES[i + opt.view.xOffset],\n          this.gridLeft + opt.grid.x * i,\n          this.marginTop / 2);\n    if(opt.coordinates && opt.coordinates.bottom)\n      this.ctx.fillText(C.COORDINATES[i + opt.view.xOffset],\n          this.gridLeft + opt.grid.x * i,\n          canvas.height - this.marginBottom / 2);\n  }\n\n  // Draw vertical coordinates\n  for(i=0; i<opt.view.height; i++) {\n    if(opt.coordinates && opt.coordinates.left)\n      this.ctx.fillText(''+(opt.board.height-opt.view.yOffset-i),\n          this.marginLeft / 2,\n          this.gridTop + opt.grid.y * i);\n    if(opt.coordinates && opt.coordinates.right)\n      this.ctx.fillText(''+(opt.board.height-opt.view.yOffset-i),\n          canvas.width - this.marginRight / 2,\n          this.gridTop + opt.grid.y * i);\n  }\n\n  // Store rendered board in another canvas for fast redraw\n  this.backup = document.createElement('canvas');\n  this.backup.width = canvas.width;\n  this.backup.height = canvas.height;\n  this.backup.getContext('2d').drawImage(canvas,\n      0, 0, canvas.width, canvas.height,\n      0, 0, canvas.width, canvas.height);\n\n\n  // Clip further drawing to board only\n  this.ctx.beginPath();\n  this.ctx.rect(this.marginLeft, this.marginTop, this.boardWidth, this.boardHeight);\n  this.ctx.clip();\n\n  // Fix Chromium bug with image glitches unless they are drawn once\n  // https://code.google.com/p/chromium/issues/detail?id=469906\n  if(this.images.black) this.ctx.drawImage(this.images.black, 10, 10);\n  if(this.images.white) this.ctx.drawImage(this.images.white, 10, 10);\n  if(this.images.shadow) this.ctx.drawImage(this.images.shadow, 10, 10);\n  // Sucks but works\n  this.restore(this.marginLeft, this.marginTop, this.boardWidth, this.boardHeight);\n};\n\n/**\n * Restore portion of canvas.\n */\nCanvas.prototype.restore = function(x, y, w, h) {\n  x = Math.floor(x);\n  y = Math.floor(y);\n  x = Math.max(x, 0);\n  y = Math.max(y, 0);\n  w = Math.min(w, this.backup.width - x);\n  h = Math.min(h, this.backup.height - y);\n  try {\n    this.ctx.drawImage(this.backup, x, y, w, h, x, y, w, h);\n  }\n  catch (e) {\n    console.log(e);\n  }\n};\n\n/**\n * Get X coordinate based on column.\n * @returns {number} Coordinate.\n */\nCanvas.prototype.getX = function(i) {\n  return this.gridLeft + this.opt.grid.x * i;\n};\n\n/**\n * Get Y coordinate based on row.\n * @returns {number} Coordinate.\n */\nCanvas.prototype.getY = function(j) {\n  return this.gridTop + this.opt.grid.y * j;\n};\n\n/**\n * Redraw canvas portion using a board.\n *\n * @param {Board} jboard Board object.\n * @param {number} i1 Starting column to be redrawn.\n * @param {number} j1 Starting row to be redrawn.\n * @param {number} i2 Ending column to be redrawn (inclusive).\n * @param {number} j2 Ending row to be redrawn (inclusive).\n */\nCanvas.prototype.draw = function(jboard, i1, j1, i2, j2) {\n  /*\n  i1 = Math.max(i1, this.opt.view.xOffset);\n  j1 = Math.max(j1, this.opt.view.yOffset);\n  i2 = Math.min(i2, this.opt.view.xOffset + this.opt.view.width - 1);\n  j2 = Math.min(j2, this.opt.view.yOffset + this.opt.view.height - 1);\n  */\n  // Due to hard to fix alignment problem with partial redraw, just override to do the full redraw\n  i1 = this.opt.view.xOffset;\n  j1 = this.opt.view.yOffset;\n  i2 = this.opt.view.xOffset + this.opt.view.width - 1;\n  j2 = this.opt.view.yOffset + this.opt.view.height - 1;\n\n  if(i2 < i1 || j2 < j1)\n    return; // nothing to do here\n\n  var x = this.getX(i1 - this.opt.view.xOffset) - this.opt.grid.x,\n      y = this.getY(j1 - this.opt.view.yOffset) - this.opt.grid.y,\n      w = this.opt.grid.x * (i2 - i1 + 2),\n      h = this.opt.grid.y * (j2 - j1 + 2);\n\n  this.ctx.save();\n  this.ctx.beginPath();\n  this.ctx.rect(x, y, w, h);\n  this.ctx.clip(); // only apply redraw to relevant area\n  this.restore(x, y, w, h); // restore background\n\n  // Expand redrawn intersections while keeping within viewport\n  i1 = Math.max(i1-1, this.opt.view.xOffset);\n  j1 = Math.max(j1-1, this.opt.view.yOffset);\n  i2 = Math.min(i2+1, this.opt.view.xOffset + this.opt.view.width - 1);\n  j2 = Math.min(j2+1, this.opt.view.yOffset + this.opt.view.height - 1);\n\n  var isLabel = /^[a-zA-Z1-9]/;\n\n  // Stone radius derived marker size parameters\n  var stoneR = this.opt.stone.radius,\n      clearW = stoneR * 1.5, clearH = stoneR * 1.2, clearFunc;\n\n  // Clear grid for labels on clear intersections before casting shadows\n  if(this.images.board) { // there is a board texture\n    clearFunc = function(ox, oy) {\n      this.ctx.drawImage(this.images.board,\n          ox - this.marginLeft - clearW / 2, oy - this.marginTop - clearH / 2, clearW, clearH,\n          ox - clearW / 2, oy - clearH / 2, clearW, clearH);\n    }.bind(this);\n  } else { // no board texture\n    this.ctx.fillStyle = this.opt.margin.color;\n    clearFunc = function(ox, oy) {\n      this.ctx.fillRect(ox - clearW / 2, oy - clearH / 2, clearW, clearH);\n    }.bind(this);\n  }\n\n  // Clear board grid under markers when needed\n  jboard.each(function(c, type, mark) {\n    // Note: Use of smt has been disabled here for clear results\n    var ox = this.getX(c.i - this.opt.view.xOffset);\n    var oy = this.getY(c.j - this.opt.view.yOffset);\n\n    if(type == C.CLEAR && mark && isLabel.test(mark))\n    clearFunc(ox, oy);\n  }.bind(this), i1, j1, i2, j2); // provide iteration limits\n\n  // Shadows\n  jboard.each(function(c, type) {\n    var ox = this.getX(c.i - this.opt.view.xOffset);\n    var oy = this.getY(c.j - this.opt.view.yOffset);\n\n    if(type == C.BLACK || type == C.WHITE) {\n      this.stones.drawShadow(this.ctx,\n          this.opt.shadow.xOff + ox,\n          this.opt.shadow.yOff + oy);\n    }\n  }.bind(this), i1, j1, i2, j2); // provide iteration limits\n\n  // Stones and marks\n  jboard.each(function(c, type, mark) {\n    var ox = (this.getX(c.i - this.opt.view.xOffset));\n    var oy = (this.getY(c.j - this.opt.view.yOffset));\n    var markColor;\n\n    switch(type) {\n      case C.BLACK:\n      case C.DIM_BLACK:\n        this.ctx.globalAlpha = type == C.BLACK ? 1 : this.opt.stone.dimAlpha;\n        this.stones.drawStone(this.ctx, type, ox, oy);\n        markColor = this.opt.mark.blackColor; // if we have marks, this is the color\n        break;\n      case C.WHITE:\n      case C.DIM_WHITE:\n        this.ctx.globalAlpha = type == C.WHITE ? 1 : this.opt.stone.dimAlpha;\n        this.stones.drawStone(this.ctx, type, ox, oy);\n        markColor = this.opt.mark.whiteColor; // if we have marks, this is the color\n        break;\n      default:\n        this.ctx.globalAlpha=1;\n        markColor = this.opt.mark.clearColor; // if we have marks, this is the color\n    }\n\n    // Common settings to all markers\n    this.ctx.lineWidth = this.opt.mark.lineWidth;\n    this.ctx.strokeStyle = markColor;\n\n    this.ctx.font = this.opt.mark.font;\n    this.ctx.fillStyle = markColor;\n    this.ctx.textAlign = 'center';\n    this.ctx.textBaseline = 'middle';\n\n    if(mark) this.stones.drawMark(this.ctx, mark, ox, oy);\n  }.bind(this), i1, j1, i2, j2); // provide iteration limits\n\n  this.ctx.restore(); // also restores globalAlpha\n};\n\n/**\n * Add an event listener to canvas (click) events. The callback will be\n * called with 'this' referring to Canvas object, with coordinate and\n * event as parameters. Supported event types are 'click', 'mousemove',\n * and 'mouseout'. With 'mouseout', there is no coordinate parameter for\n * callback.\n *\n * @param {String} event The event to listen to, e.g. 'click'.\n * @param {function} callback The callback.\n */\nCanvas.prototype.addListener = function(event, callback) {\n  this.listeners[event].push(callback);\n};\n\nexport default Canvas;\n","import * as util from './util.js';\nimport C from './constants.js';\n\n/**\n * Helper class to store node information, apply and revert changes easily.\n *\n * @param {Board} jboard Board object to make changes on.\n * @param {Node} parent Parent node or null if no parent.\n * @param {Object} info Node information - ko coordinate, comment, etc.\n * @constructor\n */\nconst Node = function(jboard, parent, info) {\n  this.jboard = jboard;\n  this.parent = parent;\n  this.info = info ? util.extend({}, info) : {};\n  this.children = [];\n  this.changes = [];\n\n  if(parent) {\n    parent.children.push(this); // register child\n    this.info.captures = util.extend({}, parent.info.captures);\n  } else {\n    this.info.captures = {1: 0, 2: 0}; // C.BLACK, C.WHITE\n  }\n};\n\n/**\n * Helper method to clear parent node's markers. Created to achieve SGF like\n * stateless marker behavaior.\n */\nNode.prototype.clearParentMarks = function() {\n  if(!this.parent)\n    return;\n\n  for(var i=this.parent.changes.length-1; i>=0; i--) {\n    var item = this.parent.changes[i];\n\n    if('mark' in item)\n      this.setMark(item.c, C.MARK.NONE);\n  }\n};\n\n/**\n * Helper method to make changes to a board while saving them in the node.\n *\n * @param {Object} c Coordinate or array of them.\n * @param {int} val Type.\n */\nNode.prototype.setType = function(c, val) {\n  if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setType(c[i], val); // avoid repeating ourselves\n    return;\n  }\n\n  // Store both change and previous value to enable reversion\n  this.changes.push({c: c.copy(), type: val, old: this.jboard.getType(c)});\n  this.jboard.setType(c, val);\n};\n\n/**\n * Helper method to make changes to a board while saving them in the node.\n *\n * @param {Object} c Coordinate or array of them.\n * @param {int} val Mark.\n */\nNode.prototype.setMark = function(c, val) {\n  if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setMark(c[i], val); // avoid repeating ourselves\n    return;\n  }\n\n  // Store both change and previous value to enable reversion\n  this.changes.push({c: c.copy(), mark: val, old: this.jboard.getMark(c)});\n  this.jboard.setMark(c, val);\n};\n\n\n/**\n * Apply changes of this node to board.\n */\nNode.prototype.apply = function() {\n  for(var i=0; i<this.changes.length; i++) {\n    var item = this.changes[i];\n\n    if('type' in item)\n      this.jboard.setType(item.c, item.type);\n    else\n      this.jboard.setMark(item.c, item.mark);\n  }\n};\n\n/**\n * Revert changes of this node to board.\n */\nNode.prototype.revert = function() {\n  for(var i=this.changes.length-1; i>=0; i--) {\n    var item = this.changes[i];\n\n    if('type' in item)\n      this.jboard.setType(item.c, item.old);\n    else\n      this.jboard.setMark(item.c, item.old);\n  }\n};\n\nexport default Node;\n","/**\n * A change notifier class that can listen to changes in a Board and keep\n * multiple Canvas board views up to date.\n *\n * @param {Board} jboard The board to listen to.\n * @constructor\n */\nconst Notifier = function(jboard) {\n  this.updateScheduled = false; // set on first change\n  this.canvases = []; // canvases to notify on changes\n  this.board = jboard;\n\n  this.changeFunc = function(ev) {\n    var coord = ev.coordinate;\n\n    if(this.updateScheduled) { // update already scheduled\n      this.min.i = Math.min(this.min.i, coord.i);\n      this.min.j = Math.min(this.min.j, coord.j);\n      this.max.i = Math.max(this.max.i, coord.i);\n      this.max.j = Math.max(this.max.j, coord.j);\n      return;\n    }\n\n    this.min = coord.copy();\n    this.max = coord.copy();\n    this.updateScheduled = true;\n\n    setTimeout(function() { // schedule update in the end\n      for(var c=0; c<this.canvases.length; c++)\n        this.canvases[c].draw(this.board, this.min.i, this.min.j,\n          this.max.i, this.max.j);\n\n      this.updateScheduled = false; // changes updated, scheduled function run\n    }.bind(this), 0);\n  }.bind(this);\n\n  this.board.addListener(this.changeFunc);\n};\n\n/**\n * Change the board to listen to. Notifier will stop listening previous board,\n * start listening new one and trigger full redraw of canvas.\n *\n * @param {Board} board New board to listen to.\n */\nNotifier.prototype.changeBoard = function(board) {\n  this.board.removeListener(this.changeFunc);\n  this.board = board;\n  this.board.addListener(this.changeFunc);\n  // There might be a scheduled update timeout, but ignore that, it will\n  // just redraw a portion of new board\n  for(var c=0; c<this.canvases.length; c++)\n    this.canvases[c].draw(this.board, 0, 0, this.board.width, this.board.height);\n};\n\n/**\n * Add a canvas to notify list.\n *\n * @param {Canvas} jcanvas The canvas to add.\n */\nNotifier.prototype.addCanvas = function(jcanvas) {\n  this.canvases.push(jcanvas);\n};\n\nexport default Notifier;\n","import Coordinate from './coordinate.js';\nimport C from './constants.js';\nimport * as util from './util.js';\n\n/**\n * Go board class for storing intersection states. Also has listeners that\n * are notified on any changes to the board via setType() and setMark().\n *\n * @param {int} width The width of the board\n * @param {int} [height] The height of the board\n * @constructor\n */\nconst Board = function(width, height) {\n  this.width = width;\n\n  if(height !== undefined)\n    this.height = height;\n  else { //noinspection JSSuspiciousNameCombination\n    this.height = this.width;\n  }\n\n  this.listeners = [];\n\n  this.stones = [];\n  this.marks = [];\n\n  // Initialize stones and marks\n  for(var i=0; i<this.width; ++i) {\n    var stoneArr = [], markArr = [];\n\n    for(var j=0; j<this.height; ++j) {\n      stoneArr.push(C.CLEAR);\n      markArr.push(C.MARK.NONE);\n    }\n\n    this.stones.push(stoneArr);\n    this.marks.push(markArr);\n  }\n};\n\n/**\n * Add listener to the board. Listeners are passed an event object with\n * event type ('type' or 'mark'), coordinate and board members, and new\n * and old values as newVal and oldVal. Event object should be\n * considered read only.\n *\n * @param {function} func A listener callback.\n */\nBoard.prototype.addListener = function(func) {\n  this.listeners.push(func);\n};\n\n/**\n * Remove listener from the board.\n *\n * @param {function} func A listener callback.\n */\nBoard.prototype.removeListener = function(func) {\n  var index = this.listeners.indexOf(func);\n  if(index != -1) this.listeners.splice(index, 1);\n};\n\n/**\n * Create coordinate from \"J18\" type of notation that depend from board size.\n *\n * @param {string} s The coordinate string.\n */\nBoard.prototype.getCoordinate = function(s) {\n  return new Coordinate(C.COORDINATES.indexOf(s.toUpperCase().substr(0,1)),\n      this.height - parseInt(s.substr(1)));\n};\n\n/**\n * Make a human readable \"J18\" type string representation of the coordinate.\n *\n * @param {Coordinate} c Coordinate.\n * @returns {string} representation.\n */\nBoard.prototype.toString = function(c) {\n  return C.COORDINATES[c.i] + (this.height-c.j);\n};\n\n/**\n * Simple iteration over all coordinates.\n *\n * @param {func} func The iterator method, which is called with the\n * coordinate, type and mark parameters.\n * @param {int} [i1] Column start.\n * @param {int} [j1] Row start.\n * @param {int} [i2] Colunm end.\n * @param {int} [j2] Row end.\n */\nBoard.prototype.each = function(func, i1, j1, i2, j2) {\n  var c = new Coordinate();\n\n  if(i1 === undefined) i1 = 0;\n  if(j1 === undefined) j1 = 0;\n  if(i2 === undefined) i2 = this.width-1;\n  if(j2 === undefined) j2 = this.height-1;\n\n  for(c.j=j1; c.j<=j2; c.j++)\n    for(c.i=i1; c.i<=i2; c.i++)\n      func(c.copy(), this.stones[c.i][c.j], this.marks[c.i][c.j]);\n};\n\n/**\n * Clear board.\n */\nBoard.prototype.clear = function() {\n  this.each(function(c) {\n    this.setType(c, C.CLEAR);\n    this.setMark(c, C.MARK.NONE);\n  }.bind(this));\n};\n\n/**\n * Set the intersection type at given coordinate(s).\n *\n * @param {Object} c A Coordinate or Array of them.\n * @param {Object} t New type, e.g. CLEAR, BLACK, ...\n */\nBoard.prototype.setType = function(c, t) {\n  if(c instanceof Coordinate) {\n    var old = this.stones[c.i][c.j];\n\n    if(old == t) return; // no change\n\n    this.stones[c.i][c.j] = t;\n\n    var ev = { type: 'type', coordinate: c, board: this,\n      oldVal: old, newVal: t };\n    this.listeners.forEach(function(l) { l(ev); });\n  } else if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setType(c[i], t); // use ourself to avoid duplicate code\n  }\n};\n\n\n/**\n * Set the intersection mark at given coordinate(s).\n *\n * @param {Object} c A Coordinate or Array of them.\n * @param {Object} m New mark, e.g. MARK.NONE, MARK.TRIANGLE, ...\n */\nBoard.prototype.setMark = function(c, m) {\n  if(c instanceof Coordinate) {\n    var old = this.marks[c.i][c.j];\n\n    if(old == m) return; // no change\n\n    this.marks[c.i][c.j] = m;\n\n    var ev = { type: 'mark', coordinate: c, board: this,\n      oldVal: old, newVal: m };\n    this.listeners.forEach(function(l) { l(ev); });\n  } else if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setMark(c[i], m); // use ourself to avoid duplicate code\n  }\n};\n\n/**\n * Get the intersection type(s) at given coordinate(s).\n *\n * @param {Object} c A Coordinate or an Array of them.\n * @returns {Object} Type or array of types.\n */\nBoard.prototype.getType = function(c) {\n  var ret;\n\n  if(c instanceof Coordinate) {\n    ret = this.stones[c.i][c.j];\n  } else if(c instanceof Array) {\n    ret = [];\n    for(var i=0, len=c.length; i<len; ++i)\n      ret.push(this.stones[c[i].i][c[i].j]);\n  }\n\n  return ret;\n};\n\n/**\n * Get the intersection mark(s) at given coordinate(s).\n *\n * @param {Object} c A Coordinate or an Array of them.\n * @returns {Object} Mark or array of marks.\n */\nBoard.prototype.getMark = function(c) {\n  var ret;\n\n  if(c instanceof Coordinate) {\n    ret = this.marks[c.i][c.j];\n  } else if(c instanceof Array) {\n    ret = [];\n    for(var i=0, len=c.length; i<len; ++i)\n      ret.push(this.marks[c[i].i][c[i].j]);\n  }\n\n  return ret;\n};\n\n/**\n * Get neighboring coordinates on board.\n *\n * @param {Coordinate} c The coordinate\n * @returns {Array} The array of adjacent coordinates (2-4)\n */\nBoard.prototype.getAdjacent = function(c) {\n  var coordinates = [], i = c.i, j = c.j;\n\n  if(i>0)\n    coordinates.push(new Coordinate(i-1, j));\n  if(i+1<this.width)\n    coordinates.push(new Coordinate(i+1, j));\n  if(j>0)\n    coordinates.push(new Coordinate(i, j-1));\n  if(j+1<this.height)\n    coordinates.push(new Coordinate(i, j+1));\n\n  return coordinates;\n};\n\n/**\n * Filter coordinates based on intersection type.\n *\n * @param {Object} c An array of Coordinates.\n * @param {Object} t A type filter (return only matching type).\n * @returns {Object} Object with attributes 'type' and 'mark', array or false.\n */\nBoard.prototype.filter = function(c, t) {\n  var ret = [];\n  for(var i=0, len=c.length; i<len; ++i)\n    if(this.stones[c[i].i][c[i].j] == t)\n      ret.push(c[i]);\n  return ret;\n};\n\n/**\n * Check if coordinates contain given type.\n *\n * @param {Object} c An array of Coordinates.\n * @param {Object} t A type filter (return only matching type).\n * @returns {bool} True or false.\n */\nBoard.prototype.hasType = function(c, t) {\n  for(var i=0, len=c.length; i<len; ++i)\n    if(this.stones[c[i].i][c[i].j] == t)\n      return true;\n  return false;\n};\n\n/**\n * Search all intersections of similar type, return group and edge coordinates.\n *\n * @param {Coordinate} coord The coordinate from which to start search.\n * @param {int} [overrideType] Treat current coordinate as this type.\n * @returns {Object} Two arrays of coordinates in members 'group' and 'neighbors'.\n */\nBoard.prototype.getGroup = function(coord, overrideType) {\n  var type = overrideType || this.getType(coord), seen = {},\n      group = [coord.copy()], neighbors = [],\n      queue = this.getAdjacent(coord);\n\n  seen[coord.toString()] = true;\n\n  while(queue.length) {\n    var c = queue.shift();\n\n    if(c.toString() in seen)\n      continue; // seen already\n    else\n      seen[c.toString()] = true; // seen now\n\n    if(this.getType(c) == type) { // check if type is correct\n      group.push(c);\n      queue = queue.concat(this.getAdjacent(c)); // add prospects\n    } else\n      neighbors.push(c);\n  }\n\n  return {group: group, neighbors: neighbors};\n};\n\n/**\n * Get a raw copy of board contents. Will not include any listeners!\n *\n * @returns {Object} Board contents.\n */\nBoard.prototype.getRaw = function() {\n  return {\n    width: this.width,\n      height: this.height,\n      stones: util.extend({}, this.stones),\n      marks: util.extend({}, this.marks)\n  };\n};\n\n/**\n * Set a raw copy of board contents. Will not change or call any listeners!\n *\n * @param {Object} raw Board contents.\n */\nBoard.prototype.setRaw = function(raw) {\n  this.width = raw.width;\n  this.height = raw.height;\n  this.stones = raw.stones;\n  this.marks = raw.marks;\n};\n\n/**\n * Clone a board. This will only copy stones and marks, not listeners!\n *\n * @returns {Object} Cloned board.\n */\nBoard.prototype.clone = function() {\n  var board = new Board();\n  board.setRaw(this.getRaw());\n  return board;\n};\n\n/**\n * Calculate impact of a move on board. Returns a data structure outlining\n * validness of move (success & errorMsg) and possible captures and ko\n * coordinate.\n *\n * @param {Board} jboard Board to play the move on (stays unchanged).\n * @param {Coordinate} coord Coordinate to play or null for pass.\n * @param {int} stone Stone to play - BLACK or WHITE.\n * @param {Coordinate} [ko] Coordinate of previous ko.\n * @returns {Object} Move result data structure.\n */\nBoard.prototype.playMove = function(coord, stone, ko) {\n  var oppType = (stone == C.BLACK ? C.WHITE : C.BLACK),\n      captures = [], adjacent, captured = {};\n\n  if(!coord) // pass\n    return { success: true, captures: [], ko: false };\n\n  if(this.getType(coord) != C.CLEAR)\n    return { success: false,\n      errorMsg: 'Cannot play on existing stone!' };\n\n  if(ko && coord.equals(ko))\n    return { success: false,\n      errorMsg: 'Cannot retake ko immediately!' };\n\n  adjacent = this.getAdjacent(coord); // find adjacent coordinates\n\n  for(var i=0; i<adjacent.length; i++) {\n    var c = adjacent[i];\n    if(c.toString() in captured) continue; // avoid double capture\n\n    if(this.getType(c) == oppType) { // potential capture\n      var g = this.getGroup(c);\n\n      if(this.filter(g.neighbors, C.CLEAR).length === 1) {\n        captures = captures.concat(g.group);\n        // save captured coordinates so we don't capture them twice\n        for(var j=0; j<g.group.length; j++)\n          captured[g.group[j].toString()] = true; \n      }\n    }\n  }\n\n  // Suicide not allowed\n  if(captures.length === 0 &&\n      !this.hasType(this.getGroup(coord, stone).neighbors, C.CLEAR))\n    return { success: false,\n      errorMsg: 'Suicide is not allowed!' };\n\n  // Check for ko. Note that captures were not removed so there should\n  // be zero liberties around this stone in case of a ko. Also, if the\n  // adjacent intersections contain stones of same color, it is not ko.\n  if(captures.length == 1 && this.filter(adjacent, C.CLEAR).length === 0\n      && this.filter(adjacent, stone).length === 0)\n    return { success: true, captures: captures, ko: captures[0].copy() };\n\n  return { success: true, captures: captures, ko: false };\n};\n\nexport default Board;\n","import Board from './board.js';\nimport Node from './node.js';\n\n/**\n * Create a go game record that can handle plays and variations. A Board\n * object is created that will reflect the current position in game record.\n *\n * @param {int} width Board width.\n * @param {int} height Board height.\n * @constructor\n */\nvar Record = function(width, height) {\n  this.jboard = new Board(width, height ? height : width);\n  this.root = this.current = null;\n  this.info = {}; // game information\n};\n\n/**\n * Get board object.\n *\n * @returns {Board} Board object.\n */\nRecord.prototype.getBoard = function() {\n  return this.jboard;\n};\n\n/**\n * Get current node.\n *\n * @returns {Node} Current node.\n */\nRecord.prototype.getCurrentNode = function() {\n  return this.current;\n};\n\n\n/**\n * Get root node.\n *\n * @returns {Node} Root node.\n */\nRecord.prototype.getRootNode = function() {\n  return this.root;\n};\n\n/**\n * Create new empty node under current one.\n *\n * @param {bool} clearParentMarks True to clear parent node marks.\n * @param {Object} info Node information - ko coordinate, comment, etc.\n * @returns {Node} New, current node.\n */\nRecord.prototype.createNode = function(clearParentMarks, options) {\n  var node = new Node(this.jboard, this.current, options);\n\n  if(clearParentMarks)\n    node.clearParentMarks();\n\n  if(this.root === null)\n    this.root = node;\n\n  return (this.current = node);\n};\n\n/**\n * Advance to the next node in the game tree.\n *\n * @param {int} [variation] parameter to specify which variation to select, if there are several branches.\n * @returns {Node} New current node or null if at the end of game tree.\n */\nRecord.prototype.next = function(variation) {\n  if(this.current === null)\n    return null;\n\n  if(!variation)\n    variation = 0;\n\n  if(variation >= this.current.children.length)\n    return null;\n\n  this.current = this.current.children[variation];\n  this.current.apply(this.jboard);\n\n  return this.current;\n};\n\n/**\n * Back up a node in the game tree.\n *\n * @returns {Node} New current node or null if at the beginning of game tree.\n */\nRecord.prototype.previous = function() {\n  if(this.current === null || this.current.parent === null)\n    return null; // empty or no parent\n\n  this.current.revert(this.jboard);\n  this.current = this.current.parent;\n\n  return this.current;\n};\n\n/**\n * Get current variation number (zero-based).\n *\n * @returns {int} Current variations.\n */\nRecord.prototype.getVariation = function() {\n  if(this.current === null || this.current.parent === null)\n    return 0;\n  return this.current.parent.children.indexOf(this.current);\n};\n\n/**\n * Go to a variation. Uses previous() and next().\n *\n * @param {int} [variation] parameter to specify which variation to select, if there are several branches.\n */\nRecord.prototype.setVariation = function(variation) {\n  if(this.previous() === null)\n    return null;\n  return this.next(variation);\n};\n\n/**\n * Get number of variations for current node.\n *\n * @returns {int} Number of variations.\n */\nRecord.prototype.getVariations = function() {\n  if(this.current === null || this.current.parent === null)\n    return 1;\n\n  return this.current.parent.children.length; // \"nice\"\n};\n\n/**\n * Go to the beginning of the game tree.\n *\n * @returns {Node} New current node.\n */\nRecord.prototype.first = function() {\n  this.current = this.root;\n  this.jboard.clear();\n\n  if(this.current !== null)\n    this.current.apply(this.jboard);\n\n  return this.current;\n};\n\n/**\n * Create a snapshot of current Record state. Will contain board state and\n * current node.\n *\n * @returns Snapshot to be used with restoreSnapshot().\n */\nRecord.prototype.createSnapshot = function() {\n  return {jboard: this.jboard.getRaw(), current: this.current};\n};\n\n/**\n * Restore the Record to the state contained in snapshot. Use only if you\n * REALLY know what you are doing, this is mainly for creating Record\n * quickly from SGF.\n *\n * @param {Object} raw Snapshot created with createSnapshot().\n */\nRecord.prototype.restoreSnapshot = function(raw) {\n  this.jboard.setRaw(raw.jboard);\n  this.current = raw.current;\n};\n\n/**\n * Normalize record so the longest variation is the first.\n *\n * @param {Node} node The node to start with. Defaults to root if unset.\n * @returns int Length of longest subsequence.\n */\nRecord.prototype.normalize = function(node) {\n  var i, len, maxLen = 0, maxI = 0;\n\n  if(!node) node = this.getRootNode();\n\n  for(i=0; i<node.children.length; i++) {\n    len = this.normalize(node.children[i]);\n    if(maxLen < len) { maxLen = len; maxI = i; }\n  }\n\n  if(maxI) { // If needed, swap longest first\n    i = node.children[0];\n    node.children[0] = node.children[maxI];\n    node.children[maxI] = i;\n  }\n\n  return maxLen + 1; // longest subsequence plus this\n};\n\nexport default Record;\n","import Notifier from './notifier.js';\nimport Canvas from './canvas.js';\nimport * as util from './util.js';\n\n/**\n * Setup helper class to make creating Canvases easy.\n *\n * @param {Board} jboard Board object to listen to.\n * @param {Object} boardOptions Base board options like BOARD.large.\n * @constructor\n */\nvar Setup = function(board, boardOptions) {\n  var defaults = {\n    margin: {color:'white'},\n    edge: {top:true, bottom:true, left:true, right:true},\n    coordinates: {top:true, bottom:true, left:true, right:true},\n    stars: {points: 0 },\n    board: {width:board.width, height:board.height},\n    view: {xOffset:0, yOffset:0, width:board.width, height:board.height}\n  };\n\n  if(board.width == board.height) {\n    switch(board.width) { // square\n      case 9:\n        defaults.stars.points=5;\n        defaults.stars.offset=2;\n        break;\n      case 13:\n      case 19:\n        defaults.stars.points=9;\n        defaults.stars.offset=3;\n        break;\n    }\n  }\n\n  this.board = board; // board to follow\n  this.notifier = new Notifier(this.board); // notifier to canvas\n  this.options = util.extend(defaults, boardOptions); // clone\n};\n\n/**\n * View only a portion of the whole board.\n *\n * @param {int} xOff The X offset.\n * @param {int} yOff The Y offset.\n * @param {int} width The width.\n * @param {int} height The height.\n */\nSetup.prototype.view = function(xOff, yOff, width, height) {\n  this.options.view.xOffset = xOff;\n  this.options.view.yOffset = yOff;\n  this.options.view.width = width;\n  this.options.view.height = height;\n\n  this.options.edge.left = (xOff === 0);\n  this.options.edge.right = (xOff+width == this.options.board.width);\n\n  this.options.edge.top = (yOff === 0);\n  this.options.edge.bottom = (yOff+height == this.options.board.height);\n};\n\n/**\n * Replace default options (non-viewport related)\n *\n * @param {Object} options The new options.\n */\nSetup.prototype.setOptions = function(options) {\n  util.extend(this.options, options);\n};\n\n/**\n * Get {@link Notifier} object created by this class. Can be used to\n * change the board the canvas listens to.\n *\n * @returns {Notifier} Canvas notifier.\n */\nSetup.prototype.getNotifier = function() {\n  return this.notifier;\n};\n\n/**\n * Create Canvas based on current settings. When textures are used,\n * image resources need to be loaded, so the function returns and\n * asynchronously call readyFn after actual initialization.\n *\n * @param {Object} elemId The element id or HTML Node where to create the canvas in.\n * @param {function} readyFn Function to call with canvas once it is ready.\n */\nSetup.prototype.create = function(elemId, readyFn) {\n  var options = util.extend({}, this.options); // create a copy\n\n  var createCallback = function(images) {\n    var jcanvas = new Canvas(elemId, options, images);\n\n    jcanvas.draw(this.board, 0, 0, this.board.width-1, this.board.height-1);\n\n    // Track and group later changes with Notifier\n    this.notifier.addCanvas(jcanvas);\n\n    if(readyFn) readyFn(jcanvas);\n  }.bind(this);\n\n  if(this.options.textures) // at least some textures exist\n    util.loadImages(this.options.textures, createCallback);\n  else // blain BW board\n    createCallback({black:false,white:false,shadow:false,board:false});\n};\n\nexport default Setup;\n","/**\n * SGF loading module.\n * @module sgf\n */\n\nimport Coordinate from './coordinate.js';\nimport Record from './record.js';\nimport C from './constants.js';\n\nvar ERROR; // error holder for sgfParse etc.\n\nvar fieldMap = {\n  'AN': 'annotator',\n  'CP': 'copyright',\n  'DT': 'date',\n  'EV': 'event',\n  'GN': 'gameName',\n  'OT': 'overtime',\n  'RO': 'round',\n  'RE': 'result',\n  'RU': 'rules',\n  'SO': 'source',\n  'TM': 'time',\n  'PC': 'location',\n  'PB': 'black',\n  'PW': 'white',\n  'BR': 'blackRank',\n  'WR': 'whiteRank',\n  'BT': 'blackTeam',\n  'WT': 'whiteTeam'\n};\n\n/*\n * Helper function to handle single coordinates as well as coordinate lists.\n *\n * @param {object} propValues A property value array containing a mix of coordinates (aa) and lists (aa:bb)\n * @returns {array} An array of Coordinate objects matching the given property values.\n */\nfunction explodeSGFList(propValues) {\n  var coords = [];\n\n  for(var i=0, len=propValues.length; i<len; i++) {\n    var val = propValues[i];\n\n    if(val.indexOf(':') == -1) { // single coordinate\n      coords.push(new Coordinate(val));\n    } else {\n      var tuple = val.split(':'), c1, c2, coord;\n\n      c1 = new Coordinate(tuple[0]);\n      c2 = new Coordinate(tuple[1]);\n      coord = new Coordinate();\n\n      for(coord.i=c1.i; coord.i<=c2.i; ++coord.i)\n        for(coord.j=c1.j; coord.j<=c2.j; ++coord.j)\n          coords.push(coord.copy());\n    }\n  }\n\n  return coords;\n}\n\nfunction sgfMove(node, name, values, moveMarks) {\n  var coord, player, opponent, play;\n\n  if(name == 'B') {\n    player = C.BLACK;\n    opponent = C.WHITE;\n  } else if('W') {\n    player = C.WHITE;\n    opponent = C.BLACK;\n  }\n\n  coord = (values[0].length == 2) ? new Coordinate(values[0]) : null;\n\n  // Apparently, IGS wants to use outside-board coordinates for pass\n  if(coord !== null && (coord.i >= node.jboard.width || coord.j >= node.jboard.height))\n    coord = null; // Thank you, IGS\n\n  play = node.jboard.playMove(coord, player);\n  node.info.captures[player] += play.captures.length; // tally captures\n\n  if(moveMarks && play.ko)\n      node.setMark(play.ko, C.MARK.SQUARE);\n  \n  if(play.success && coord !== null) {\n    node.setType(coord, player); // play stone\n    node.setType(play.captures, C.CLEAR); // clear opponent's stones\n    if(moveMarks)\n      node.setMark(coord, C.MARK.CIRCLE);\n  } else ERROR = play.error;\n\n  return play.success;\n}\n\nfunction sgfSetup(node, name, values) {\n  var setupMap = {'AB': C.BLACK, 'AW': C.WHITE, 'AE': C.CLEAR};\n\n  node.setType(explodeSGFList(values), setupMap[name]);\n  return true;\n}\n\nfunction sgfMarker(node, name, values) {\n  var markerMap = {\n    'TW': C.MARK.WHITE_TERRITORY,\n    'TB': C.MARK.BLACK_TERRITORY,\n    'CR': C.MARK.CIRCLE,\n    'TR': C.MARK.TRIANGLE,\n    'MA': C.MARK.CROSS,\n    'SQ': C.MARK.SQUARE\n  };\n\n  node.setMark(explodeSGFList(values), markerMap[name]);\n  return true;\n}\n\nfunction sgfComment(node, name, values) {\n  node.info.comment = values[0];\n  return true;\n}\n\nfunction sgfHandicap(node, name, values) {\n  node.info.handicap = values[0];\n  return true;\n}\n\nfunction sgfLabel(node, name, values) {\n  for(var i=0; i<values.length; i++) {\n    var v = values[i], tuple = v.split(':');\n\n    node.setMark(new Coordinate(tuple[0]), tuple[1]);\n  }\n  return true;\n}\n\nfunction sgfInfo(node, name, values) {\n  var field = fieldMap[name];\n\n  node.info[field] = values[0];\n  return true;\n}\n\nvar SGFProperties = {\n  'B': sgfMove,\n  'W': sgfMove,\n  'AB': sgfSetup,\n  'AW': sgfSetup,\n  'AE': sgfSetup,\n  'C': sgfComment,\n  'LB': sgfLabel,\n  'HA': sgfHandicap,\n  'TW': sgfMarker,\n  'TB': sgfMarker,\n  'CR': sgfMarker,\n  'TR': sgfMarker,\n  'MA': sgfMarker,\n  'SQ': sgfMarker,\n  'AN': sgfInfo,\n  'CP': sgfInfo,\n  'DT': sgfInfo,\n  'EV': sgfInfo,\n  'GN': sgfInfo,\n  'OT': sgfInfo,\n  'RO': sgfInfo,\n  'RE': sgfInfo,\n  'RU': sgfInfo,\n  'SO': sgfInfo,\n  'TM': sgfInfo,\n  'PC': sgfInfo,\n  'PB': sgfInfo,\n  'PW': sgfInfo,\n  'BR': sgfInfo,\n  'WR': sgfInfo,\n  'BT': sgfInfo,\n  'WT': sgfInfo\n};\n\n/*\n * Parse SGF string into object tree representation:\n *\n * tree = { sequence: [ <node(s)> ], leaves: [ <subtree(s), if any> ] }\n *\n * Each node is an object containing property identifiers and associated values in array:\n *\n * node = {'B': ['nn'], 'C': ['This is a comment']}\n *\n * @param {String} sgf The SGF in string format, whitespace allowed.\n * @returns {Object} Root node or false on error. Error stored to ERROR variable.\n */\nfunction parseSGF(sgf) {\n  var tokens, i, len, token, // for loop vars\n      lastBackslash = false, // flag to note if last string ended in escape\n      bracketOpen = -1, // the index where bracket opened\n      processed = [];\n\n  if('a~b'.split(/(~)/).length === 3) {\n    tokens = sgf.split(/([\\[\\]\\(\\);])/); // split into an array at '[', ']', '(', ')', and ';', and include separators in array\n  } else { // Thank you IE for not working\n    var blockStart = 0, delimiters = '[]();';\n\n    tokens = [];\n\n    for(i=0, len=sgf.length; i<len; ++i) {\n      if(delimiters.indexOf(sgf.charAt(i)) !== -1) {\n        if(blockStart < i)\n          tokens.push(sgf.substring(blockStart, i));\n        tokens.push(sgf.charAt(i));\n        blockStart = i+1;\n      }\n    }\n\n    if(blockStart < i) // leftovers\n      tokens.push(sgf.substr(blockStart, i));\n  }\n\n  // process through tokens and push everything into processed, but merge stuff between square brackets into one element, unescaping escaped brackets\n  // i.e. ['(', ';', 'C', '[', 'this is a comment containing brackets ', '[', '\\\\', ']', ']'] becomes:\n  // ['(', ';', 'C', '[', 'this is a comment containing brackets []]']\n  // after this transformation, it's just '(', ')', ';', 'ID', and '[bracket stuff]' elements in the processed array\n  for(i=0, len=tokens.length; i<len; ++i) {\n    token = tokens[i];\n\n    if(bracketOpen == -1) { // handling elements outside property values (i.e. square brackets)\n      token = token.replace(/^\\s+|\\s+$/g, ''); // trim whitespace, it is irrelevant here\n      if(token == '[') // found one\n        bracketOpen = i;\n      else if(token !== '') // we are outside brackets, so just push everything nonempty as it is into 'processed'\n        processed.push(token);\n    } else { // bracket is open, we're now looking for a ] without preceding \\\n      if(token != ']') { // a text segment\n        lastBackslash = (token.charAt(token.length-1) == '\\\\'); // true if string ends in \\\n      } else { // a closing bracket\n        if(lastBackslash) { // it's escaped - we continue\n          lastBackslash = false;\n        } else { // it's not escaped - we close the segment\n          processed.push(tokens.slice(bracketOpen, i+1).join('').replace(/\\\\\\]/g, ']')); // push the whole thing including brackets, and unescape the inside closing brackets\n          bracketOpen = -1;\n        }\n      }\n    }\n  }\n\n  // basic error checking\n  if(processed.length === 0) {\n    ERROR = 'SGF was empty!';\n    return false;\n  } else if(processed[0] != '(' || processed[1] != ';' || processed[processed.length-1] != ')') {\n    ERROR = 'SGF did not start with \\'(;\\' or end with \\')\\'!';\n    return false;\n  }\n\n  // collect 'XY', '[AB]', '[CD]' sequences (properties) in a node into {'XY': ['AB', 'CD']} type of associative array\n  // effectively parsing '(;GM[1]FF[4];B[pd])' into ['(', {'GM': ['1'], 'FF': ['4']}, {'B': ['pd']}, ')']\n\n  // start again with 'tokens' and process into 'processed'\n  tokens = processed;\n  processed = [];\n\n  var node, propertyId = ''; // node under construction, and current property identifier\n\n  // the following code is not strict on format, so let's hope it's well formed\n  for(i=0, len=tokens.length; i<len; ++i) {\n    token = tokens[i];\n\n    if(token == '(' || token == ')') {\n      if(node) { // flush and reset node if necessary\n        if(propertyId !== '' && node[propertyId].length === 0) { // last property was missing value\n          ERROR = 'Missing property value at ' + token + '!';\n          return false;\n        }\n        processed.push(node);\n        node = undefined;\n      }\n\n      processed.push(token); // push this token also\n    } else if(token == ';') { // new node\n      if(node) { // flush if necessary\n        if(propertyId !== '' && node[propertyId].length === 0) { // last property was missing value\n          ERROR = 'Missing property value at ' + token + '!';\n          return false;\n        }\n        processed.push(node);\n      }\n\n      node = {};\n      propertyId = ''; // initialize the new node\n    } else { // it's either a property identifier or a property value\n      if(token.indexOf('[') !== 0) { // it's property identifier\n        if(propertyId !== '' && node[propertyId].length === 0) { // last property was missing value\n          ERROR = 'Missing property value at ' + token + '!';\n          return false;\n        }\n\n        if(token in node) { // duplicate key\n          ERROR = 'Duplicate property identifier ' + token + '!';\n          return false;\n        }\n\n        propertyId = token;\n        node[propertyId] = []; // initialize new property with empty value array\n      } else { // it's property value\n        if(propertyId === '') { // we're missing the identifier\n          ERROR = 'Missing property identifier at ' + token + '!';\n          return false;\n        }\n\n        node[propertyId].push(token.substring(1, token.length-1)); // remove enclosing brackets\n      }\n    }\n  }\n\n  tokens = processed;\n\n  // finally, construct a game tree from '(', ')', and sequence arrays - each leaf is {sequence: [ <list of nodes> ], leaves: [ <list of leaves> ]}\n  var stack = [], currentRoot = {sequence: [], leaves: []}, lastRoot; // we know first element already: '('\n\n  for(i=1, len=tokens.length; i<len-1; ++i) {\n    token = tokens[i];\n\n    if(token == '(') { // enter a subleaf\n      if(currentRoot.sequence.length === 0) { // consecutive parenthesis without node sequence in between will throw an error\n        ERROR = 'SGF contains a game tree without a sequence!';\n        return false;\n      }\n      stack.push(currentRoot); // save current leaf for when we return\n      currentRoot = {sequence: [], leaves: []};\n    } else if(token == ')') { // return from subleaf\n      if(currentRoot.sequence.length === 0) { // consecutive parenthesis without node sequence in between will throw an error\n        ERROR = 'SGF contains a game tree without a sequence!';\n        return false;\n      }\n      lastRoot = currentRoot;\n      currentRoot = stack.pop();\n      currentRoot.leaves.push(lastRoot);\n    } else { // if every '(' is not followed by exactly one array of nodes (as it should), this code fails\n      currentRoot.sequence.push(token);\n    }\n  }\n\n  if(stack.length > 0) {\n    ERROR = 'Invalid number of parentheses in the SGF!';\n    return false;\n  }\n\n  return currentRoot;\n}\n\n/*\n * Apply SGF nodes recursively to create a game tree.\n * @returns true on success, false on error. Error message in ERROR.\n */\nfunction recurseRecord(jrecord, gameTree, moveMarks) {\n  for(var i=0; i<gameTree.sequence.length; i++) {\n    var node = gameTree.sequence[i],\n      jnode = jrecord.createNode(true); // clear parent marks\n\n    for(var key in node) {\n      if(node.hasOwnProperty(key)) {\n        if(!(key in SGFProperties))\n          continue;\n\n        if(!SGFProperties[key](jnode, key, node[key], moveMarks)) {\n          ERROR = 'Error while parsing node ' + key + ': ' + ERROR;\n          return false;\n        }\n      }\n    }\n  }\n\n  for(i=0; i<gameTree.leaves.length; i++) {\n    var subTree = gameTree.leaves[i], snapshot;\n\n    snapshot = jrecord.createSnapshot();\n\n    if(!recurseRecord(jrecord, subTree, moveMarks))\n      return false; // fall through on errors\n\n    jrecord.restoreSnapshot(snapshot);\n  }\n\n  return true;\n}\n\n/*\n * Convert game tree to a record.\n * @returns {Object} Record or false on failure. Error stored in ERROR.\n */\nfunction gameTreeToRecord(gameTree, moveMarks) {\n  var jrecord, root = gameTree.sequence[0], width = 19, height = 19;\n\n  if('SZ' in root) {\n    var size = root.SZ[0];\n\n    if(size.indexOf(':') != -1) {\n      width = parseInt(size.substring(0, size.indexOf(':')));\n      height = parseInt(size.substr(size.indexOf(':')+1));\n    } else width = height = parseInt(size);\n  }\n\n  jrecord = new Record(width, height);\n\n  if(!recurseRecord(jrecord, gameTree, moveMarks))\n    return false;\n\n  jrecord.first(); // rewind to start\n\n  return jrecord;\n}\n\n/**\n * Parse SGF and return {@link Record} object(s).\n *\n * @param {String} sgf The SGF file as a string.\n * @param {bool} moveMarks Create move and ko marks in the record.\n * @returns {Object} Record object, array of them, or string on error.\n */\nexport function load(sgf, moveMarks) {\n  var gameTree = parseSGF(sgf);\n\n  if(gameTree === false)\n    return ERROR;\n\n  if(gameTree.sequence.length === 0) { // potentially multiple records\n    var ret = [];\n\n    if(gameTree.leaves.length === 0)\n      return 'Empty game tree!';\n\n    for(var i=0; i<gameTree.leaves.length; i++) {\n      var rec = gameTreeToRecord(gameTree, moveMarks);\n\n      if(!rec)\n        return ERROR;\n\n      ret.push(rec); // return each leaf as separate record\n    }\n\n    return ret;\n  }\n\n  return gameTreeToRecord(gameTree, moveMarks);\n}\n\nexport default { load };\n","//var request = require('superagent');\nimport C from './constants.js';\n\n/**\n * Automatic div module.\n * @module autodiv\n */\n\nfunction parseMarkup(str) {\n  var lines = str.split('\\n'), data = [];\n\n  // Handle div contents as diagram contents\n  for(var i = 0, len = lines.length; i < len; ++i) {\n    var elems = [], line = lines[i];\n\n    for(var j = 0, len2 = line.length; j < len2; ++j) {\n      switch(line[j]) {\n        case '.':\n          elems.push({type: C.CLEAR}); break;\n        case 'o':\n          elems.push({type: C.WHITE}); break;\n        case 'x':\n          elems.push({type: C.BLACK}); break;\n        case ' ':\n          break; // ignore whitespace\n        default: // assume marker\n          if(!elems.length) break; // no intersection yet\n          // Append to mark so x123 etc. are possible\n          if(elems[elems.length - 1].mark)\n            elems[elems.length - 1].mark += line[j];\n          else\n            elems[elems.length - 1].mark = line[j];\n      }\n    }\n\n    if(elems.length) data.push(elems);\n  }\n\n  return data;\n}\n\n// Array of loaded boards\n//var boards = [];\n\n// Available attributes:\n// data-jgostyle: Evaluated and used as board style\n// data-jgosize: Used as board size unless data-jgosgf is defined\n// data-jgoview: Used to define viewport\nfunction process(JGO, div) {\n  // Handle special jgo-* attributes\n  var style, width, height, TL, BR; // last two are viewport\n\n  if(div.getAttribute('data-jgostyle')) {\n    /*jshint evil:true  */\n    style = eval(div.getAttribute('data-jgostyle'));\n  } else style = JGO.BOARD.medium;\n\n  if(div.getAttribute('data-jgosize')) {\n    var size = div.getAttribute('data-jgosize');\n\n    if(size.indexOf('x') != -1) {\n      width = parseInt(size.substring(0, size.indexOf('x')));\n      height = parseInt(size.substr(size.indexOf('x')+1));\n    } else width = height = parseInt(size);\n  }\n\n  //if(div.getAttribute('data-jgosgf'))\n\n  var data = parseMarkup(div.innerHTML);\n  div.innerHTML = '';\n\n  if(!width) { // Size still missing\n    if(!data.length) return; // no size or data, no board\n\n    height = data.length;\n    width = data[0].length;\n  }\n\n  var jboard = new JGO.Board(width, height);\n  var jsetup = new JGO.Setup(jboard, style);\n\n  if(div.getAttribute('data-jgoview')) {\n    var tup = div.getAttribute('data-jgoview').split('-');\n    TL = jboard.getCoordinate(tup[0]);\n    BR = jboard.getCoordinate(tup[1]);\n  } else {\n    TL = new JGO.Coordinate(0,0);\n    BR = new JGO.Coordinate(width-1, height-1);\n  }\n\n  jsetup.view(TL.i, TL.j, width-TL.i, height-TL.j);\n\n  var c = new JGO.Coordinate();\n\n  for(c.j = TL.j; c.j <= BR.j; ++c.j) {\n    for(c.i = TL.i; c.i <= BR.i; ++c.i) {\n      var elem = data[c.j - TL.j][c.i - TL.i];\n      jboard.setType(c, elem.type);\n      if(elem.mark) jboard.setMark(c, elem.mark);\n    }\n  }\n\n  jsetup.create(div);\n}\n\n/**\n * Find all div elements with class 'jgoboard' and initialize them.\n */\nexport function init(document, JGO) {\n  var matches = document.querySelectorAll('div.jgoboard');\n\n  for(var i = 0, len = matches.length; i < len; ++i)\n    process(JGO, matches[i]);\n}\n\nexport default { init };\n","import JGO from './constants.js'; // base for JGO object\nimport Coordinate from './coordinate.js';\nimport Canvas from './canvas.js';\nimport Node from './node.js';\nimport Notifier from './notifier.js';\nimport Record from './record.js';\nimport Setup from './setup.js';\nimport Stones from './stones.js';\nimport Board from './board.js';\nimport * as util from './util.js';\nimport sgf from './sgf.js';\nimport auto from './auto.js';\n\n// Assemble the JGO object\nJGO.Coordinate = Coordinate;\nJGO.Canvas = Canvas;\nJGO.Node = Node;\nJGO.Notifier = Notifier;\nJGO.Record = Record;\nJGO.Setup = Setup;\nJGO.Stones = Stones;\nJGO.Board = Board;\nJGO.util = util;\nJGO.sgf = sgf;\nJGO.auto = auto;\n\n// Named exports for tree-shaking\nexport {\n  Coordinate,\n  Canvas,\n  Node,\n  Notifier,\n  Record,\n  Setup,\n  Stones,\n  Board,\n  util,\n  sgf,\n  auto\n};\n\nexport default JGO;\n","import JGO from './JGO/index.js';\n\n// Export for UMD builds (will be global in browser)\nif (typeof window !== 'undefined') {\n  window.JGO = JGO;\n}\n\n// Also export as default for ESM usage\nexport default JGO;\n\n// Re-export named exports for tree-shaking\nexport * from './JGO/index.js';\n"],"names":["c","size","C","elem","util.extend","jboard","width","height","util.loadImages","sgf","data","document","JGO"],"mappings":"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"}