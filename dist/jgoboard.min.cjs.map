{"version":3,"file":"jgoboard.min.cjs","sources":["../JGO/coordinate.js","../JGO/util.js","../JGO/constants.js","../JGO/stones.js","../JGO/canvas.js","../JGO/node.js","../JGO/notifier.js","../JGO/board.js","../JGO/record.js","../JGO/setup.js","../JGO/sgf.js","../JGO/auto.js","../JGO/index.js","../main.js"],"sourcesContent":["const SGFLetters = 'abcdefghijklmnopqrstuvwxyz'.split('');\n\n/**\n * Create a helper class to create coordinates from (1,2) (zero-based),\n * 'ah' type of input. You can create a coordinate with no arguments, in\n * which case it defaults to (0,0), or with one argument, in which case it\n * tries to parse 'ai' type of string coordinate, or with two arguments, (i,j).\n * 'J18' style coordinates depend on board size due to number running from\n * bottom, so those need to be instantiated from Board.getCoordinate.\n *\n * @param {int} [i] Column or SGF-style string.\n * @param {int} [j] Row.\n * @constructor\n */\nconst Coordinate = function(i, j) {\n  if(i !== undefined) {\n    if(j !== undefined) {\n      this.i = i;\n      this.j = j;\n    } else { // try to parse coordinates from first parameter\n      this.i = 0;\n      this.j = 0;\n\n      if(typeof i != 'string')\n        return;\n\n      // assume SGF-type coordinate\n      i = i.toLowerCase();\n\n      this.i = SGFLetters.indexOf(i.substr(0,1));\n      this.j = SGFLetters.indexOf(i.substr(1));\n    }\n  } else { // called without both parameters\n    this.i = 0;\n    this.j = 0;\n  }\n};\n\n/**\n * Compare with another coordinate.\n *\n * @param {Coordinate} Coordinate.\n * @returns {boolean} true if equal, false if not.\n */\nCoordinate.prototype.equals = function(c) {\n  return (c.i == this.i) && (c.j == this.j);\n};\n\n/**\n * Make an SGF-type 'ai' string representation of the coordinate.\n *\n * @returns {string} String representation.\n */\nCoordinate.prototype.toString = function() {\n  return SGFLetters[this.i] + SGFLetters[this.j];\n};\n\n/**\n * Make a copy of this coordinate.\n *\n * @returns {Coordinate} A copy of this coordinate.\n */\nCoordinate.prototype.copy = function() {\n  return new Coordinate(this.i, this.j);\n};\n\nexport default Coordinate;\n","/**\n * Utility function module.\n * @module util\n */\n\nimport Coordinate from './coordinate.js';\n\n/**\n * Load images and defined by object and invoke callback when completed.\n *\n * @param {Object} sources A dictionary of sources to load.\n * @param {function} callback A callback function to call with image dict.\n */\nexport function loadImages(sources, callback) {\n  var images = {}, imagesLeft = 0;\n\n  for(var src in sources) // count non-false properties as images\n    if(sources.hasOwnProperty(src) && sources[src])\n      imagesLeft++;\n\n  var countdown = function() {\n    if(--imagesLeft <= 0) {\n      callback(images);\n    }\n  };\n\n  for(src in sources) { // load non-false properties to images object\n    if(sources.hasOwnProperty(src) && sources[src]) {\n      /* global Image */\n      images[src] = new Image();\n      images[src].onload = countdown;\n      images[src].src = sources[src];\n    }\n  }\n};\n\n/**\n * Helper function to create coordinates for standard handicap placement.\n *\n * @param {int} size Board size (9, 13, 19 supported).\n * @param {itn} num Number of handicap stones.\n * @returns {Array} Array of Coordinate objects.\n */\nexport function getHandicapCoordinates(size, num) {\n  // Telephone dial style numbering\n  var handicapPlaces = [[], [], [3,7], [3,7,9], [1,3,7,9], [1,3,5,7,9],\n      [1,3,4,6,7,9], [1,3,4,5,6,7,9], [1,2,3,4,6,7,8,9],\n      [1,2,3,4,5,6,7,8,9]];\n  var places = handicapPlaces[num], offset = (size <= 9 ? 2 : 3),\n      step = (size - 1) / 2 - offset, coords = [];\n\n  if(places) {\n    for(var n=0; n<places.length; n++) {\n      var i = (places[n]-1) % 3, j = Math.floor((places[n]-1) / 3);\n      coords.push(new Coordinate(offset+i*step, offset+j*step));\n    }\n  }\n\n  return coords;\n};\n\n/**\n * Deep extend an object.\n *\n * @function extend\n * @param {Object} dest Destination object to extend.\n * @param {Object} src Source object which properties will be copied.\n * @returns {Object} Extended destination object.\n */\nexport function extend(dest, src) {\n  for(var key in src) {\n    if(src.hasOwnProperty(key)) {\n      if(typeof src[key] === 'object') {\n        if(!dest[key] || (typeof dest[key] !== 'object'))\n          dest[key] = {}; // create/overwrite if necessary\n        extend(dest[key], src[key]);\n      } else dest[key] = src[key];\n    }\n  }\n\n  return dest;\n}\n","import { extend } from './util.js';\n\n/**\n * Enum for intersection types. Aliased in JGO namespace, e.g. JGO.BLACK.\n * @enum\n * @readonly\n */\nexport const INTERSECTION = {\n  CLEAR: 0,\n  /** Black stone */\n  BLACK: 1,\n  /** White stone */\n  WHITE: 2,\n  /** Semi-transparent black stone */\n  DIM_BLACK: 3,\n  /** Semi-transparent white stone */\n  DIM_WHITE: 4\n};\n\n/**\n * Enum for marker types.\n * @readonly\n * @enum\n */\nexport const MARK = {\n  /** No marker ('') */\n  NONE: '',\n  /** Selected intersection */\n  SELECTED: '^',\n  /** Square */\n  SQUARE: '#',\n  /** Triangle */\n  TRIANGLE: '/',\n  /** Circle */\n  CIRCLE: '0',\n  /** Cross */\n  CROSS: '*',\n  /** Black territory */\n  BLACK_TERRITORY: '-',\n  /** White territory */\n  WHITE_TERRITORY: '+'\n};\n\n/**\n * Board coordinate array.\n * @constant\n */\nexport const COORDINATES = 'ABCDEFGHJKLMNOPQRSTUVWXYZ'.split('');\n\n// Create the base JGO object with all exports\nconst JGO = {\n  INTERSECTION,\n  MARK,\n  COORDINATES\n};\n\n// Alias all INTERSECTION properties into globals (for backward compatibility)\nextend(JGO, INTERSECTION);\n\nexport default JGO;\n","import C from './constants.js';\n\n/**\n * Create a jGoBoard stones object. This is a facility that can draw\n * stones and markers on a HTML5 canvas. Only used internally by the\n * library.\n *\n * @param {Object} options Options array.\n * @constructor\n */\nvar Stones = function(options, images) {\n  this.stoneR = options.stone.radius;\n  this.gridX = options.grid.x;\n  this.gridY = options.grid.x;\n  this.markX = this.stoneR * 1.1;\n  this.markY = this.stoneR * 1.1;\n  this.circleR = this.stoneR * 0.5;\n  this.triangleR = this.stoneR * 0.9;\n  this.images = images;\n};\n\nStones.prototype.drawStone = function(ctx, type, ox, oy, scale) {\n  if(!scale) scale = 1;\n  var stone = (type == C.BLACK || type == C.DIM_BLACK) ? this.images.black : this.images.white;\n\n  if(!stone) { // BW\n    ctx.fillStyle = (type == C.WHITE) ? '#FFFFFF' : '#000000';\n    ctx.beginPath();\n    ctx.arc(ox, oy, this.stoneR*scale, 2*Math.PI, false);\n    ctx.fill();\n\n    if(type == C.WHITE) {\n      ctx.strokeStyle = '#000000';\n      ctx.stroke();\n    }\n  } else {\n    // round x, y for crisp rendering\n    ctx.drawImage(stone, 0, 0, stone.width, stone.height,\n        Math.round(ox - stone.width / 2 * scale),\n        Math.round(oy - stone.height / 2 * scale),\n        stone.width * scale, stone.height * scale);\n  }\n};\n\nStones.prototype.drawShadow = function(ctx, ox, oy, scale) {\n  var shadow = this.images.shadow;\n  if(!shadow) return;\n  if(!scale) scale = 1;\n\n  ctx.drawImage(shadow, 0, 0, shadow.width, shadow.height,\n      Math.round(ox - shadow.width / 2 * scale),\n      Math.round(oy - shadow.height / 2 * scale),\n      shadow.width * scale, shadow.height * scale);\n};\n\nStones.prototype.drawMark = function(ctx, mark, ox, oy) {\n  switch(mark) {\n    case C.MARK.SQUARE:\n      ctx.beginPath();\n      ctx.rect(ox - this.markX / 2, oy - this.markY / 2, this.markX, this.markY);\n      ctx.stroke();\n      break;\n\n    case C.MARK.CROSS:\n      ctx.beginPath();\n      ctx.moveTo(ox - this.markX / 2, oy + this.markY / 2);\n      ctx.lineTo(ox + this.markX / 2, oy - this.markY / 2);\n      ctx.moveTo(ox - this.markX / 2, oy - this.markY / 2);\n      ctx.lineTo(ox + this.markX / 2, oy + this.markY / 2);\n      ctx.stroke();\n      break;\n\n    case C.MARK.TRIANGLE:\n      ctx.beginPath();\n      for(var r=0; r<3; r++) {\n        ctx.moveTo(ox + this.triangleR * Math.cos(Math.PI * (0.5 + 2*r/3)),\n            oy - this.triangleR * Math.sin(Math.PI * (0.5 + 2*r/3)));\n        ctx.lineTo(ox + this.triangleR * Math.cos(Math.PI * (0.5 + 2*(r+1)/3)),\n            oy - this.triangleR * Math.sin(Math.PI * (0.5 + 2*(r+1)/3)));\n      }\n      ctx.stroke();\n      break;\n\n    case C.MARK.CIRCLE:\n      ctx.beginPath();\n      ctx.arc(ox, oy, this.circleR, 2*Math.PI, false);\n      ctx.stroke();\n      break;\n\n    case C.MARK.BLACK_TERRITORY:\n      ctx.globalAlpha=1;\n      this.drawStone(ctx, C.BLACK, ox, oy, 0.5);\n      break;\n\n    case C.MARK.WHITE_TERRITORY:\n      ctx.globalAlpha=1;\n      this.drawStone(ctx, C.WHITE, ox, oy, 0.5);\n      break;\n\n    case C.MARK.SELECTED:\n      ctx.globalAlpha=0.5;\n      ctx.fillStyle = '#8080FF';\n      //ctx.beginPath();\n      ctx.fillRect(ox - this.gridX / 2, oy - this.gridY / 2,\n          this.gridX, this.gridY);\n      break;\n\n    default: // Label\n      // For clear intersections, grid is cleared before shadow cast\n      ctx.fillText(mark, ox, oy);\n      break;\n  }\n};\n\nexport default Stones;\n","import C from './constants.js';\nimport Coordinate from './coordinate.js';\nimport Stones from './stones.js';\nimport * as util from './util.js';\n\n/**\n * Create a jGoBoard canvas object.\n *\n * @param {Object} elem Container HTML element or its id.\n * @param {Object} opt Options object.\n * @param {Object} images Set of images (or false values) for drawing.\n * @constructor\n */\nvar Canvas = function(elem, opt, images) {\n  /* global document */\n  if(typeof elem === 'string')\n    elem = document.getElementById(elem);\n\n  var canvas = document.createElement('canvas'), i, j;\n\n  var padLeft = opt.edge.left ? opt.padding.normal : opt.padding.clipped,\n      padRight = opt.edge.right ? opt.padding.normal : opt.padding.clipped,\n      padTop = opt.edge.top ? opt.padding.normal : opt.padding.clipped,\n      padBottom = opt.edge.bottom ? opt.padding.normal : opt.padding.clipped;\n\n  this.marginLeft = opt.edge.left ? opt.margin.normal : opt.margin.clipped;\n  this.marginRight = opt.edge.right ? opt.margin.normal : opt.margin.clipped;\n  this.marginTop = opt.edge.top ? opt.margin.normal : opt.margin.clipped;\n  this.marginBottom = opt.edge.bottom ? opt.margin.normal : opt.margin.clipped;\n\n  this.boardWidth = padLeft + padRight +\n    opt.grid.x * opt.view.width;\n  this.boardHeight = padTop + padBottom +\n    opt.grid.y * opt.view.height;\n\n  this.width = canvas.width =\n    this.marginLeft + this.marginRight + this.boardWidth;\n  this.height = canvas.height =\n    this.marginTop + this.marginBottom + this.boardHeight;\n\n  this.listeners = {'click': [], 'mousemove': [], 'mouseout': []};\n\n  /**\n   * Get board coordinate based on screen coordinates.\n   * @param {number} x Coordinate.\n   * @param {number} y Coordinate.\n   * @returns {Coordinate} Board coordinate.\n   */\n  this.getCoordinate = function(pageX, pageY) {\n    var bounds = canvas.getBoundingClientRect(),\n        scaledX = (pageX - bounds.left) * canvas.width / (bounds.right - bounds.left),\n        scaledY = (pageY - bounds.top) * canvas.height / (bounds.bottom - bounds.top);\n\n    return new Coordinate(\n        Math.floor((scaledX-this.marginLeft-padLeft)/opt.grid.x) + opt.view.xOffset,\n        Math.floor((scaledY-this.marginTop-padTop)/opt.grid.y) + opt.view.yOffset);\n  }.bind(this);\n\n  // Click handler will call all listeners passing the coordinate of click\n  // and the click event\n  canvas.onclick = function(ev) {\n    var c = this.getCoordinate(ev.clientX, ev.clientY),\n        listeners = this.listeners.click;\n\n    for(var l=0; l<listeners.length; l++)\n      listeners[l].call(this, c.copy(), ev);\n  }.bind(this);\n\n  var lastMove = new Coordinate(-1,-1);\n\n  // Move handler will call all listeners passing the coordinate of move\n  // whenever mouse moves over a new intersection\n  canvas.onmousemove = function(ev) {\n    if(!this.listeners.mousemove.length) return;\n\n    var c = this.getCoordinate(ev.clientX, ev.clientY),\n        listeners = this.listeners.mousemove;\n\n    if(c.i < this.opt.view.xOffset ||\n        c.i >= this.opt.view.xOffset + this.opt.view.width)\n      c.i = -1;\n\n    if(c.j < this.opt.view.yOffset ||\n        c.j >= this.opt.view.yOffset + this.opt.view.height)\n      c.j = -1;\n\n    if(lastMove.equals(c))\n      return; // no change\n    else\n      lastMove = c.copy();\n\n    for(var l=0; l<listeners.length; l++)\n      listeners[l].call(this, c.copy(), ev);\n  }.bind(this);\n\n  // Mouseout handler will again call all listeners of that event, no\n  // coordinates will be passed of course, only the event\n  canvas.onmouseout = function(ev) {\n    var listeners = this.listeners.mouseout;\n\n    for(var l=0; l<listeners.length; l++)\n      listeners[l].call(this, ev);\n  }.bind(this);\n\n  elem.appendChild(canvas);\n\n  this.ctx = canvas.getContext('2d');\n  this.opt = util.extend({}, opt); // make a copy just in case\n  this.stones = new Stones(opt, images);\n  this.images = images;\n\n  // Fill margin with correct color\n  this.ctx.fillStyle = opt.margin.color;\n  this.ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  if(this.images.board) {\n    // Prepare to draw board with shadow\n    this.ctx.save();\n    this.ctx.shadowColor = opt.boardShadow.color;\n    this.ctx.shadowBlur = opt.boardShadow.blur;\n    this.ctx.shadowOffsetX = opt.boardShadow.offX;\n    this.ctx.shadowOffsetX = opt.boardShadow.offY;\n\n    var clipTop = opt.edge.top ? 0 : this.marginTop,\n        clipLeft = opt.edge.left ? 0 : this.marginLeft,\n        clipBottom = opt.edge.bottom ? 0 : this.marginBottom,\n        clipRight = opt.edge.right ? 0 : this.marginRight;\n\n    // Set clipping to throw shadow only on actual edges\n    this.ctx.beginPath();\n    this.ctx.rect(clipLeft, clipTop,\n        canvas.width - clipLeft - clipRight,\n        canvas.height - clipTop - clipBottom);\n    this.ctx.clip();\n\n    this.ctx.drawImage(this.images.board, 0, 0,\n        this.boardWidth, this.boardHeight,\n        this.marginLeft, this.marginTop,\n        this.boardWidth, this.boardHeight);\n\n    // Draw lighter border around the board to make it more photography\n    this.ctx.strokeStyle = opt.border.color;\n    this.ctx.lineWidth = opt.border.lineWidth;\n    this.ctx.beginPath();\n    this.ctx.rect(this.marginLeft, this.marginTop,\n        this.boardWidth, this.boardHeight);\n    this.ctx.stroke();\n\n    this.ctx.restore(); // forget shadow and clipping\n  }\n\n  // Top left center of grid (not edge, center!)\n  this.gridTop = this.marginTop + padTop + opt.grid.y / 2;\n  this.gridLeft = this.marginLeft + padLeft + opt.grid.x / 2;\n\n  this.ctx.strokeStyle = opt.grid.color;\n\n  var smt = this.opt.grid.smooth; // with 0.5 there will be full antialias\n\n  // Draw vertical gridlines\n  for(i=0; i<opt.view.width; i++) {\n    if((i === 0 && opt.edge.left) || (i+1 == opt.view.width && opt.edge.right))\n      this.ctx.lineWidth = opt.grid.borderWidth;\n    else\n      this.ctx.lineWidth = opt.grid.lineWidth;\n\n    this.ctx.beginPath();\n\n    this.ctx.moveTo(smt + this.gridLeft + opt.grid.x * i,\n        smt + this.gridTop - (opt.edge.top ? 0 : opt.grid.y / 2 + padTop/2));\n    this.ctx.lineTo(smt + this.gridLeft + opt.grid.x * i,\n        smt + this.gridTop + opt.grid.y * (opt.view.height - 1) +\n        (opt.edge.bottom ? 0 : opt.grid.y / 2 + padBottom/2));\n    this.ctx.stroke();\n  }\n\n  // Draw horizontal gridlines\n  for(i=0; i<opt.view.height; i++) {\n    if((i === 0 && opt.edge.top) || (i+1 == opt.view.height && opt.edge.bottom))\n      this.ctx.lineWidth = opt.grid.borderWidth;\n    else\n      this.ctx.lineWidth = opt.grid.lineWidth;\n\n    this.ctx.beginPath();\n\n    this.ctx.moveTo(smt + this.gridLeft - (opt.edge.left ? 0 : opt.grid.x / 2 + padLeft/2),\n        smt + this.gridTop + opt.grid.y * i);\n    this.ctx.lineTo(smt + this.gridLeft + opt.grid.x * (opt.view.width - 1) +\n        (opt.edge.right ? 0 : opt.grid.x / 2 + padRight/2),\n        smt + this.gridTop + opt.grid.y * i);\n    this.ctx.stroke();\n  }\n\n  if(opt.stars.points) { // If star points\n    var step = (opt.board.width - 1) / 2 - opt.stars.offset;\n    // 1, 4, 5, 8 and 9 points are supported, rest will result in randomness\n    for(j=0; j<3; j++) {\n      for(i=0; i<3; i++) {\n        if(j == 1 && i == 1) { // center\n          if(opt.stars.points % 2 === 0)\n            continue; // skip center\n        } else if(i == 1 || j == 1) { // non-corners\n          if(opt.stars.points < 8)\n            continue; // skip non-corners\n        } else { // corners\n          if(opt.stars.points < 4)\n            continue; // skip corners\n        }\n\n        var x = (opt.stars.offset + i * step) - opt.view.xOffset,\n            y = (opt.stars.offset + j * step) - opt.view.yOffset;\n\n        if(x < 0 || y < 0 || x >= opt.view.width || y >= opt.view.height)\n          continue; // invisible\n\n        this.ctx.beginPath();\n        this.ctx.arc(smt + this.gridLeft + x * opt.grid.x,\n            smt + this.gridTop + y * opt.grid.y,\n            opt.stars.radius, 2*Math.PI, false);\n        this.ctx.fillStyle = opt.grid.color;\n        this.ctx.fill();\n      }\n    }\n  }\n\n  this.ctx.font = opt.coordinates.font;\n  this.ctx.fillStyle = opt.coordinates.color;\n  this.ctx.textAlign = 'center';\n  this.ctx.textBaseline = 'middle';\n\n  // Draw horizontal coordinates\n  for(i=0; i<opt.view.width; i++) {\n    if(opt.coordinates && opt.coordinates.top)\n      this.ctx.fillText(C.COORDINATES[i + opt.view.xOffset],\n          this.gridLeft + opt.grid.x * i,\n          this.marginTop / 2);\n    if(opt.coordinates && opt.coordinates.bottom)\n      this.ctx.fillText(C.COORDINATES[i + opt.view.xOffset],\n          this.gridLeft + opt.grid.x * i,\n          canvas.height - this.marginBottom / 2);\n  }\n\n  // Draw vertical coordinates\n  for(i=0; i<opt.view.height; i++) {\n    if(opt.coordinates && opt.coordinates.left)\n      this.ctx.fillText(''+(opt.board.height-opt.view.yOffset-i),\n          this.marginLeft / 2,\n          this.gridTop + opt.grid.y * i);\n    if(opt.coordinates && opt.coordinates.right)\n      this.ctx.fillText(''+(opt.board.height-opt.view.yOffset-i),\n          canvas.width - this.marginRight / 2,\n          this.gridTop + opt.grid.y * i);\n  }\n\n  // Store rendered board in another canvas for fast redraw\n  this.backup = document.createElement('canvas');\n  this.backup.width = canvas.width;\n  this.backup.height = canvas.height;\n  this.backup.getContext('2d').drawImage(canvas,\n      0, 0, canvas.width, canvas.height,\n      0, 0, canvas.width, canvas.height);\n\n\n  // Clip further drawing to board only\n  this.ctx.beginPath();\n  this.ctx.rect(this.marginLeft, this.marginTop, this.boardWidth, this.boardHeight);\n  this.ctx.clip();\n\n  // Fix Chromium bug with image glitches unless they are drawn once\n  // https://code.google.com/p/chromium/issues/detail?id=469906\n  if(this.images.black) this.ctx.drawImage(this.images.black, 10, 10);\n  if(this.images.white) this.ctx.drawImage(this.images.white, 10, 10);\n  if(this.images.shadow) this.ctx.drawImage(this.images.shadow, 10, 10);\n  // Sucks but works\n  this.restore(this.marginLeft, this.marginTop, this.boardWidth, this.boardHeight);\n};\n\n/**\n * Restore portion of canvas.\n */\nCanvas.prototype.restore = function(x, y, w, h) {\n  x = Math.floor(x);\n  y = Math.floor(y);\n  x = Math.max(x, 0);\n  y = Math.max(y, 0);\n  w = Math.min(w, this.backup.width - x);\n  h = Math.min(h, this.backup.height - y);\n  try {\n    this.ctx.drawImage(this.backup, x, y, w, h, x, y, w, h);\n  }\n  catch (e) {\n    console.log(e);\n  }\n};\n\n/**\n * Get X coordinate based on column.\n * @returns {number} Coordinate.\n */\nCanvas.prototype.getX = function(i) {\n  return this.gridLeft + this.opt.grid.x * i;\n};\n\n/**\n * Get Y coordinate based on row.\n * @returns {number} Coordinate.\n */\nCanvas.prototype.getY = function(j) {\n  return this.gridTop + this.opt.grid.y * j;\n};\n\n/**\n * Redraw canvas portion using a board.\n *\n * @param {Board} jboard Board object.\n * @param {number} i1 Starting column to be redrawn.\n * @param {number} j1 Starting row to be redrawn.\n * @param {number} i2 Ending column to be redrawn (inclusive).\n * @param {number} j2 Ending row to be redrawn (inclusive).\n */\nCanvas.prototype.draw = function(jboard, i1, j1, i2, j2) {\n  /*\n  i1 = Math.max(i1, this.opt.view.xOffset);\n  j1 = Math.max(j1, this.opt.view.yOffset);\n  i2 = Math.min(i2, this.opt.view.xOffset + this.opt.view.width - 1);\n  j2 = Math.min(j2, this.opt.view.yOffset + this.opt.view.height - 1);\n  */\n  // Due to hard to fix alignment problem with partial redraw, just override to do the full redraw\n  i1 = this.opt.view.xOffset;\n  j1 = this.opt.view.yOffset;\n  i2 = this.opt.view.xOffset + this.opt.view.width - 1;\n  j2 = this.opt.view.yOffset + this.opt.view.height - 1;\n\n  if(i2 < i1 || j2 < j1)\n    return; // nothing to do here\n\n  var x = this.getX(i1 - this.opt.view.xOffset) - this.opt.grid.x,\n      y = this.getY(j1 - this.opt.view.yOffset) - this.opt.grid.y,\n      w = this.opt.grid.x * (i2 - i1 + 2),\n      h = this.opt.grid.y * (j2 - j1 + 2);\n\n  this.ctx.save();\n  this.ctx.beginPath();\n  this.ctx.rect(x, y, w, h);\n  this.ctx.clip(); // only apply redraw to relevant area\n  this.restore(x, y, w, h); // restore background\n\n  // Expand redrawn intersections while keeping within viewport\n  i1 = Math.max(i1-1, this.opt.view.xOffset);\n  j1 = Math.max(j1-1, this.opt.view.yOffset);\n  i2 = Math.min(i2+1, this.opt.view.xOffset + this.opt.view.width - 1);\n  j2 = Math.min(j2+1, this.opt.view.yOffset + this.opt.view.height - 1);\n\n  var isLabel = /^[a-zA-Z1-9]/;\n\n  // Stone radius derived marker size parameters\n  var stoneR = this.opt.stone.radius,\n      clearW = stoneR * 1.5, clearH = stoneR * 1.2, clearFunc;\n\n  // Clear grid for labels on clear intersections before casting shadows\n  if(this.images.board) { // there is a board texture\n    clearFunc = function(ox, oy) {\n      this.ctx.drawImage(this.images.board,\n          ox - this.marginLeft - clearW / 2, oy - this.marginTop - clearH / 2, clearW, clearH,\n          ox - clearW / 2, oy - clearH / 2, clearW, clearH);\n    }.bind(this);\n  } else { // no board texture\n    this.ctx.fillStyle = this.opt.margin.color;\n    clearFunc = function(ox, oy) {\n      this.ctx.fillRect(ox - clearW / 2, oy - clearH / 2, clearW, clearH);\n    }.bind(this);\n  }\n\n  // Clear board grid under markers when needed\n  jboard.each(function(c, type, mark) {\n    // Note: Use of smt has been disabled here for clear results\n    var ox = this.getX(c.i - this.opt.view.xOffset);\n    var oy = this.getY(c.j - this.opt.view.yOffset);\n\n    if(type == C.CLEAR && mark && isLabel.test(mark))\n    clearFunc(ox, oy);\n  }.bind(this), i1, j1, i2, j2); // provide iteration limits\n\n  // Shadows\n  jboard.each(function(c, type) {\n    var ox = this.getX(c.i - this.opt.view.xOffset);\n    var oy = this.getY(c.j - this.opt.view.yOffset);\n\n    if(type == C.BLACK || type == C.WHITE) {\n      this.stones.drawShadow(this.ctx,\n          this.opt.shadow.xOff + ox,\n          this.opt.shadow.yOff + oy);\n    }\n  }.bind(this), i1, j1, i2, j2); // provide iteration limits\n\n  // Stones and marks\n  jboard.each(function(c, type, mark) {\n    var ox = (this.getX(c.i - this.opt.view.xOffset));\n    var oy = (this.getY(c.j - this.opt.view.yOffset));\n    var markColor;\n\n    switch(type) {\n      case C.BLACK:\n      case C.DIM_BLACK:\n        this.ctx.globalAlpha = type == C.BLACK ? 1 : this.opt.stone.dimAlpha;\n        this.stones.drawStone(this.ctx, type, ox, oy);\n        markColor = this.opt.mark.blackColor; // if we have marks, this is the color\n        break;\n      case C.WHITE:\n      case C.DIM_WHITE:\n        this.ctx.globalAlpha = type == C.WHITE ? 1 : this.opt.stone.dimAlpha;\n        this.stones.drawStone(this.ctx, type, ox, oy);\n        markColor = this.opt.mark.whiteColor; // if we have marks, this is the color\n        break;\n      default:\n        this.ctx.globalAlpha=1;\n        markColor = this.opt.mark.clearColor; // if we have marks, this is the color\n    }\n\n    // Common settings to all markers\n    this.ctx.lineWidth = this.opt.mark.lineWidth;\n    this.ctx.strokeStyle = markColor;\n\n    this.ctx.font = this.opt.mark.font;\n    this.ctx.fillStyle = markColor;\n    this.ctx.textAlign = 'center';\n    this.ctx.textBaseline = 'middle';\n\n    if(mark) this.stones.drawMark(this.ctx, mark, ox, oy);\n  }.bind(this), i1, j1, i2, j2); // provide iteration limits\n\n  this.ctx.restore(); // also restores globalAlpha\n};\n\n/**\n * Add an event listener to canvas (click) events. The callback will be\n * called with 'this' referring to Canvas object, with coordinate and\n * event as parameters. Supported event types are 'click', 'mousemove',\n * and 'mouseout'. With 'mouseout', there is no coordinate parameter for\n * callback.\n *\n * @param {String} event The event to listen to, e.g. 'click'.\n * @param {function} callback The callback.\n */\nCanvas.prototype.addListener = function(event, callback) {\n  this.listeners[event].push(callback);\n};\n\nexport default Canvas;\n","import * as util from './util.js';\nimport C from './constants.js';\n\n/**\n * Helper class to store node information, apply and revert changes easily.\n *\n * @param {Board} jboard Board object to make changes on.\n * @param {Node} parent Parent node or null if no parent.\n * @param {Object} info Node information - ko coordinate, comment, etc.\n * @constructor\n */\nconst Node = function(jboard, parent, info) {\n  this.jboard = jboard;\n  this.parent = parent;\n  this.info = info ? util.extend({}, info) : {};\n  this.children = [];\n  this.changes = [];\n\n  if(parent) {\n    parent.children.push(this); // register child\n    this.info.captures = util.extend({}, parent.info.captures);\n  } else {\n    this.info.captures = {1: 0, 2: 0}; // C.BLACK, C.WHITE\n  }\n};\n\n/**\n * Helper method to clear parent node's markers. Created to achieve SGF like\n * stateless marker behavaior.\n */\nNode.prototype.clearParentMarks = function() {\n  if(!this.parent)\n    return;\n\n  for(var i=this.parent.changes.length-1; i>=0; i--) {\n    var item = this.parent.changes[i];\n\n    if('mark' in item)\n      this.setMark(item.c, C.MARK.NONE);\n  }\n};\n\n/**\n * Helper method to make changes to a board while saving them in the node.\n *\n * @param {Object} c Coordinate or array of them.\n * @param {int} val Type.\n */\nNode.prototype.setType = function(c, val) {\n  if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setType(c[i], val); // avoid repeating ourselves\n    return;\n  }\n\n  // Store both change and previous value to enable reversion\n  this.changes.push({c: c.copy(), type: val, old: this.jboard.getType(c)});\n  this.jboard.setType(c, val);\n};\n\n/**\n * Helper method to make changes to a board while saving them in the node.\n *\n * @param {Object} c Coordinate or array of them.\n * @param {int} val Mark.\n */\nNode.prototype.setMark = function(c, val) {\n  if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setMark(c[i], val); // avoid repeating ourselves\n    return;\n  }\n\n  // Store both change and previous value to enable reversion\n  this.changes.push({c: c.copy(), mark: val, old: this.jboard.getMark(c)});\n  this.jboard.setMark(c, val);\n};\n\n\n/**\n * Apply changes of this node to board.\n */\nNode.prototype.apply = function() {\n  for(var i=0; i<this.changes.length; i++) {\n    var item = this.changes[i];\n\n    if('type' in item)\n      this.jboard.setType(item.c, item.type);\n    else\n      this.jboard.setMark(item.c, item.mark);\n  }\n};\n\n/**\n * Revert changes of this node to board.\n */\nNode.prototype.revert = function() {\n  for(var i=this.changes.length-1; i>=0; i--) {\n    var item = this.changes[i];\n\n    if('type' in item)\n      this.jboard.setType(item.c, item.old);\n    else\n      this.jboard.setMark(item.c, item.old);\n  }\n};\n\nexport default Node;\n","/**\n * A change notifier class that can listen to changes in a Board and keep\n * multiple Canvas board views up to date.\n *\n * @param {Board} jboard The board to listen to.\n * @constructor\n */\nconst Notifier = function(jboard) {\n  this.updateScheduled = false; // set on first change\n  this.canvases = []; // canvases to notify on changes\n  this.board = jboard;\n\n  this.changeFunc = function(ev) {\n    var coord = ev.coordinate;\n\n    if(this.updateScheduled) { // update already scheduled\n      this.min.i = Math.min(this.min.i, coord.i);\n      this.min.j = Math.min(this.min.j, coord.j);\n      this.max.i = Math.max(this.max.i, coord.i);\n      this.max.j = Math.max(this.max.j, coord.j);\n      return;\n    }\n\n    this.min = coord.copy();\n    this.max = coord.copy();\n    this.updateScheduled = true;\n\n    setTimeout(function() { // schedule update in the end\n      for(var c=0; c<this.canvases.length; c++)\n        this.canvases[c].draw(this.board, this.min.i, this.min.j,\n          this.max.i, this.max.j);\n\n      this.updateScheduled = false; // changes updated, scheduled function run\n    }.bind(this), 0);\n  }.bind(this);\n\n  this.board.addListener(this.changeFunc);\n};\n\n/**\n * Change the board to listen to. Notifier will stop listening previous board,\n * start listening new one and trigger full redraw of canvas.\n *\n * @param {Board} board New board to listen to.\n */\nNotifier.prototype.changeBoard = function(board) {\n  this.board.removeListener(this.changeFunc);\n  this.board = board;\n  this.board.addListener(this.changeFunc);\n  // There might be a scheduled update timeout, but ignore that, it will\n  // just redraw a portion of new board\n  for(var c=0; c<this.canvases.length; c++)\n    this.canvases[c].draw(this.board, 0, 0, this.board.width, this.board.height);\n};\n\n/**\n * Add a canvas to notify list.\n *\n * @param {Canvas} jcanvas The canvas to add.\n */\nNotifier.prototype.addCanvas = function(jcanvas) {\n  this.canvases.push(jcanvas);\n};\n\nexport default Notifier;\n","import Coordinate from './coordinate.js';\nimport C from './constants.js';\nimport * as util from './util.js';\n\n/**\n * Go board class for storing intersection states. Also has listeners that\n * are notified on any changes to the board via setType() and setMark().\n *\n * @param {int} width The width of the board\n * @param {int} [height] The height of the board\n * @constructor\n */\nconst Board = function(width, height) {\n  this.width = width;\n\n  if(height !== undefined)\n    this.height = height;\n  else { //noinspection JSSuspiciousNameCombination\n    this.height = this.width;\n  }\n\n  this.listeners = [];\n\n  this.stones = [];\n  this.marks = [];\n\n  // Initialize stones and marks\n  for(var i=0; i<this.width; ++i) {\n    var stoneArr = [], markArr = [];\n\n    for(var j=0; j<this.height; ++j) {\n      stoneArr.push(C.CLEAR);\n      markArr.push(C.MARK.NONE);\n    }\n\n    this.stones.push(stoneArr);\n    this.marks.push(markArr);\n  }\n};\n\n/**\n * Add listener to the board. Listeners are passed an event object with\n * event type ('type' or 'mark'), coordinate and board members, and new\n * and old values as newVal and oldVal. Event object should be\n * considered read only.\n *\n * @param {function} func A listener callback.\n */\nBoard.prototype.addListener = function(func) {\n  this.listeners.push(func);\n};\n\n/**\n * Remove listener from the board.\n *\n * @param {function} func A listener callback.\n */\nBoard.prototype.removeListener = function(func) {\n  var index = this.listeners.indexOf(func);\n  if(index != -1) this.listeners.splice(index, 1);\n};\n\n/**\n * Create coordinate from \"J18\" type of notation that depend from board size.\n *\n * @param {string} s The coordinate string.\n */\nBoard.prototype.getCoordinate = function(s) {\n  return new Coordinate(C.COORDINATES.indexOf(s.toUpperCase().substr(0,1)),\n      this.height - parseInt(s.substr(1)));\n};\n\n/**\n * Make a human readable \"J18\" type string representation of the coordinate.\n *\n * @param {Coordinate} c Coordinate.\n * @returns {string} representation.\n */\nBoard.prototype.toString = function(c) {\n  return C.COORDINATES[c.i] + (this.height-c.j);\n};\n\n/**\n * Simple iteration over all coordinates.\n *\n * @param {func} func The iterator method, which is called with the\n * coordinate, type and mark parameters.\n * @param {int} [i1] Column start.\n * @param {int} [j1] Row start.\n * @param {int} [i2] Colunm end.\n * @param {int} [j2] Row end.\n */\nBoard.prototype.each = function(func, i1, j1, i2, j2) {\n  var c = new Coordinate();\n\n  if(i1 === undefined) i1 = 0;\n  if(j1 === undefined) j1 = 0;\n  if(i2 === undefined) i2 = this.width-1;\n  if(j2 === undefined) j2 = this.height-1;\n\n  for(c.j=j1; c.j<=j2; c.j++)\n    for(c.i=i1; c.i<=i2; c.i++)\n      func(c.copy(), this.stones[c.i][c.j], this.marks[c.i][c.j]);\n};\n\n/**\n * Clear board.\n */\nBoard.prototype.clear = function() {\n  this.each(function(c) {\n    this.setType(c, C.CLEAR);\n    this.setMark(c, C.MARK.NONE);\n  }.bind(this));\n};\n\n/**\n * Set the intersection type at given coordinate(s).\n *\n * @param {Object} c A Coordinate or Array of them.\n * @param {Object} t New type, e.g. CLEAR, BLACK, ...\n */\nBoard.prototype.setType = function(c, t) {\n  if(c instanceof Coordinate) {\n    var old = this.stones[c.i][c.j];\n\n    if(old == t) return; // no change\n\n    this.stones[c.i][c.j] = t;\n\n    var ev = { type: 'type', coordinate: c, board: this,\n      oldVal: old, newVal: t };\n    this.listeners.forEach(function(l) { l(ev); });\n  } else if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setType(c[i], t); // use ourself to avoid duplicate code\n  }\n};\n\n\n/**\n * Set the intersection mark at given coordinate(s).\n *\n * @param {Object} c A Coordinate or Array of them.\n * @param {Object} m New mark, e.g. MARK.NONE, MARK.TRIANGLE, ...\n */\nBoard.prototype.setMark = function(c, m) {\n  if(c instanceof Coordinate) {\n    var old = this.marks[c.i][c.j];\n\n    if(old == m) return; // no change\n\n    this.marks[c.i][c.j] = m;\n\n    var ev = { type: 'mark', coordinate: c, board: this,\n      oldVal: old, newVal: m };\n    this.listeners.forEach(function(l) { l(ev); });\n  } else if(c instanceof Array) {\n    for(var i=0, len=c.length; i<len; ++i)\n      this.setMark(c[i], m); // use ourself to avoid duplicate code\n  }\n};\n\n/**\n * Get the intersection type(s) at given coordinate(s).\n *\n * @param {Object} c A Coordinate or an Array of them.\n * @returns {Object} Type or array of types.\n */\nBoard.prototype.getType = function(c) {\n  var ret;\n\n  if(c instanceof Coordinate) {\n    ret = this.stones[c.i][c.j];\n  } else if(c instanceof Array) {\n    ret = [];\n    for(var i=0, len=c.length; i<len; ++i)\n      ret.push(this.stones[c[i].i][c[i].j]);\n  }\n\n  return ret;\n};\n\n/**\n * Get the intersection mark(s) at given coordinate(s).\n *\n * @param {Object} c A Coordinate or an Array of them.\n * @returns {Object} Mark or array of marks.\n */\nBoard.prototype.getMark = function(c) {\n  var ret;\n\n  if(c instanceof Coordinate) {\n    ret = this.marks[c.i][c.j];\n  } else if(c instanceof Array) {\n    ret = [];\n    for(var i=0, len=c.length; i<len; ++i)\n      ret.push(this.marks[c[i].i][c[i].j]);\n  }\n\n  return ret;\n};\n\n/**\n * Get neighboring coordinates on board.\n *\n * @param {Coordinate} c The coordinate\n * @returns {Array} The array of adjacent coordinates (2-4)\n */\nBoard.prototype.getAdjacent = function(c) {\n  var coordinates = [], i = c.i, j = c.j;\n\n  if(i>0)\n    coordinates.push(new Coordinate(i-1, j));\n  if(i+1<this.width)\n    coordinates.push(new Coordinate(i+1, j));\n  if(j>0)\n    coordinates.push(new Coordinate(i, j-1));\n  if(j+1<this.height)\n    coordinates.push(new Coordinate(i, j+1));\n\n  return coordinates;\n};\n\n/**\n * Filter coordinates based on intersection type.\n *\n * @param {Object} c An array of Coordinates.\n * @param {Object} t A type filter (return only matching type).\n * @returns {Object} Object with attributes 'type' and 'mark', array or false.\n */\nBoard.prototype.filter = function(c, t) {\n  var ret = [];\n  for(var i=0, len=c.length; i<len; ++i)\n    if(this.stones[c[i].i][c[i].j] == t)\n      ret.push(c[i]);\n  return ret;\n};\n\n/**\n * Check if coordinates contain given type.\n *\n * @param {Object} c An array of Coordinates.\n * @param {Object} t A type filter (return only matching type).\n * @returns {bool} True or false.\n */\nBoard.prototype.hasType = function(c, t) {\n  for(var i=0, len=c.length; i<len; ++i)\n    if(this.stones[c[i].i][c[i].j] == t)\n      return true;\n  return false;\n};\n\n/**\n * Search all intersections of similar type, return group and edge coordinates.\n *\n * @param {Coordinate} coord The coordinate from which to start search.\n * @param {int} [overrideType] Treat current coordinate as this type.\n * @returns {Object} Two arrays of coordinates in members 'group' and 'neighbors'.\n */\nBoard.prototype.getGroup = function(coord, overrideType) {\n  var type = overrideType || this.getType(coord), seen = {},\n      group = [coord.copy()], neighbors = [],\n      queue = this.getAdjacent(coord);\n\n  seen[coord.toString()] = true;\n\n  while(queue.length) {\n    var c = queue.shift();\n\n    if(c.toString() in seen)\n      continue; // seen already\n    else\n      seen[c.toString()] = true; // seen now\n\n    if(this.getType(c) == type) { // check if type is correct\n      group.push(c);\n      queue = queue.concat(this.getAdjacent(c)); // add prospects\n    } else\n      neighbors.push(c);\n  }\n\n  return {group: group, neighbors: neighbors};\n};\n\n/**\n * Get a raw copy of board contents. Will not include any listeners!\n *\n * @returns {Object} Board contents.\n */\nBoard.prototype.getRaw = function() {\n  return {\n    width: this.width,\n      height: this.height,\n      stones: util.extend({}, this.stones),\n      marks: util.extend({}, this.marks)\n  };\n};\n\n/**\n * Set a raw copy of board contents. Will not change or call any listeners!\n *\n * @param {Object} raw Board contents.\n */\nBoard.prototype.setRaw = function(raw) {\n  this.width = raw.width;\n  this.height = raw.height;\n  this.stones = raw.stones;\n  this.marks = raw.marks;\n};\n\n/**\n * Clone a board. This will only copy stones and marks, not listeners!\n *\n * @returns {Object} Cloned board.\n */\nBoard.prototype.clone = function() {\n  var board = new Board();\n  board.setRaw(this.getRaw());\n  return board;\n};\n\n/**\n * Calculate impact of a move on board. Returns a data structure outlining\n * validness of move (success & errorMsg) and possible captures and ko\n * coordinate.\n *\n * @param {Board} jboard Board to play the move on (stays unchanged).\n * @param {Coordinate} coord Coordinate to play or null for pass.\n * @param {int} stone Stone to play - BLACK or WHITE.\n * @param {Coordinate} [ko] Coordinate of previous ko.\n * @returns {Object} Move result data structure.\n */\nBoard.prototype.playMove = function(coord, stone, ko) {\n  var oppType = (stone == C.BLACK ? C.WHITE : C.BLACK),\n      captures = [], adjacent, captured = {};\n\n  if(!coord) // pass\n    return { success: true, captures: [], ko: false };\n\n  if(this.getType(coord) != C.CLEAR)\n    return { success: false,\n      errorMsg: 'Cannot play on existing stone!' };\n\n  if(ko && coord.equals(ko))\n    return { success: false,\n      errorMsg: 'Cannot retake ko immediately!' };\n\n  adjacent = this.getAdjacent(coord); // find adjacent coordinates\n\n  for(var i=0; i<adjacent.length; i++) {\n    var c = adjacent[i];\n    if(c.toString() in captured) continue; // avoid double capture\n\n    if(this.getType(c) == oppType) { // potential capture\n      var g = this.getGroup(c);\n\n      if(this.filter(g.neighbors, C.CLEAR).length === 1) {\n        captures = captures.concat(g.group);\n        // save captured coordinates so we don't capture them twice\n        for(var j=0; j<g.group.length; j++)\n          captured[g.group[j].toString()] = true; \n      }\n    }\n  }\n\n  // Suicide not allowed\n  if(captures.length === 0 &&\n      !this.hasType(this.getGroup(coord, stone).neighbors, C.CLEAR))\n    return { success: false,\n      errorMsg: 'Suicide is not allowed!' };\n\n  // Check for ko. Note that captures were not removed so there should\n  // be zero liberties around this stone in case of a ko. Also, if the\n  // adjacent intersections contain stones of same color, it is not ko.\n  if(captures.length == 1 && this.filter(adjacent, C.CLEAR).length === 0\n      && this.filter(adjacent, stone).length === 0)\n    return { success: true, captures: captures, ko: captures[0].copy() };\n\n  return { success: true, captures: captures, ko: false };\n};\n\nexport default Board;\n","import Board from './board.js';\nimport Node from './node.js';\n\n/**\n * Create a go game record that can handle plays and variations. A Board\n * object is created that will reflect the current position in game record.\n *\n * @param {int} width Board width.\n * @param {int} height Board height.\n * @constructor\n */\nvar Record = function(width, height) {\n  this.jboard = new Board(width, height ? height : width);\n  this.root = this.current = null;\n  this.info = {}; // game information\n};\n\n/**\n * Get board object.\n *\n * @returns {Board} Board object.\n */\nRecord.prototype.getBoard = function() {\n  return this.jboard;\n};\n\n/**\n * Get current node.\n *\n * @returns {Node} Current node.\n */\nRecord.prototype.getCurrentNode = function() {\n  return this.current;\n};\n\n\n/**\n * Get root node.\n *\n * @returns {Node} Root node.\n */\nRecord.prototype.getRootNode = function() {\n  return this.root;\n};\n\n/**\n * Create new empty node under current one.\n *\n * @param {bool} clearParentMarks True to clear parent node marks.\n * @param {Object} info Node information - ko coordinate, comment, etc.\n * @returns {Node} New, current node.\n */\nRecord.prototype.createNode = function(clearParentMarks, options) {\n  var node = new Node(this.jboard, this.current, options);\n\n  if(clearParentMarks)\n    node.clearParentMarks();\n\n  if(this.root === null)\n    this.root = node;\n\n  return (this.current = node);\n};\n\n/**\n * Advance to the next node in the game tree.\n *\n * @param {int} [variation] parameter to specify which variation to select, if there are several branches.\n * @returns {Node} New current node or null if at the end of game tree.\n */\nRecord.prototype.next = function(variation) {\n  if(this.current === null)\n    return null;\n\n  if(!variation)\n    variation = 0;\n\n  if(variation >= this.current.children.length)\n    return null;\n\n  this.current = this.current.children[variation];\n  this.current.apply(this.jboard);\n\n  return this.current;\n};\n\n/**\n * Back up a node in the game tree.\n *\n * @returns {Node} New current node or null if at the beginning of game tree.\n */\nRecord.prototype.previous = function() {\n  if(this.current === null || this.current.parent === null)\n    return null; // empty or no parent\n\n  this.current.revert(this.jboard);\n  this.current = this.current.parent;\n\n  return this.current;\n};\n\n/**\n * Get current variation number (zero-based).\n *\n * @returns {int} Current variations.\n */\nRecord.prototype.getVariation = function() {\n  if(this.current === null || this.current.parent === null)\n    return 0;\n  return this.current.parent.children.indexOf(this.current);\n};\n\n/**\n * Go to a variation. Uses previous() and next().\n *\n * @param {int} [variation] parameter to specify which variation to select, if there are several branches.\n */\nRecord.prototype.setVariation = function(variation) {\n  if(this.previous() === null)\n    return null;\n  return this.next(variation);\n};\n\n/**\n * Get number of variations for current node.\n *\n * @returns {int} Number of variations.\n */\nRecord.prototype.getVariations = function() {\n  if(this.current === null || this.current.parent === null)\n    return 1;\n\n  return this.current.parent.children.length; // \"nice\"\n};\n\n/**\n * Go to the beginning of the game tree.\n *\n * @returns {Node} New current node.\n */\nRecord.prototype.first = function() {\n  this.current = this.root;\n  this.jboard.clear();\n\n  if(this.current !== null)\n    this.current.apply(this.jboard);\n\n  return this.current;\n};\n\n/**\n * Create a snapshot of current Record state. Will contain board state and\n * current node.\n *\n * @returns Snapshot to be used with restoreSnapshot().\n */\nRecord.prototype.createSnapshot = function() {\n  return {jboard: this.jboard.getRaw(), current: this.current};\n};\n\n/**\n * Restore the Record to the state contained in snapshot. Use only if you\n * REALLY know what you are doing, this is mainly for creating Record\n * quickly from SGF.\n *\n * @param {Object} raw Snapshot created with createSnapshot().\n */\nRecord.prototype.restoreSnapshot = function(raw) {\n  this.jboard.setRaw(raw.jboard);\n  this.current = raw.current;\n};\n\n/**\n * Normalize record so the longest variation is the first.\n *\n * @param {Node} node The node to start with. Defaults to root if unset.\n * @returns int Length of longest subsequence.\n */\nRecord.prototype.normalize = function(node) {\n  var i, len, maxLen = 0, maxI = 0;\n\n  if(!node) node = this.getRootNode();\n\n  for(i=0; i<node.children.length; i++) {\n    len = this.normalize(node.children[i]);\n    if(maxLen < len) { maxLen = len; maxI = i; }\n  }\n\n  if(maxI) { // If needed, swap longest first\n    i = node.children[0];\n    node.children[0] = node.children[maxI];\n    node.children[maxI] = i;\n  }\n\n  return maxLen + 1; // longest subsequence plus this\n};\n\nexport default Record;\n","import Notifier from './notifier.js';\nimport Canvas from './canvas.js';\nimport * as util from './util.js';\n\n/**\n * Setup helper class to make creating Canvases easy.\n *\n * @param {Board} jboard Board object to listen to.\n * @param {Object} boardOptions Base board options like BOARD.large.\n * @constructor\n */\nvar Setup = function(board, boardOptions) {\n  var defaults = {\n    margin: {color:'white'},\n    edge: {top:true, bottom:true, left:true, right:true},\n    coordinates: {top:true, bottom:true, left:true, right:true},\n    stars: {points: 0 },\n    board: {width:board.width, height:board.height},\n    view: {xOffset:0, yOffset:0, width:board.width, height:board.height}\n  };\n\n  if(board.width == board.height) {\n    switch(board.width) { // square\n      case 9:\n        defaults.stars.points=5;\n        defaults.stars.offset=2;\n        break;\n      case 13:\n      case 19:\n        defaults.stars.points=9;\n        defaults.stars.offset=3;\n        break;\n    }\n  }\n\n  this.board = board; // board to follow\n  this.notifier = new Notifier(this.board); // notifier to canvas\n  this.options = util.extend(defaults, boardOptions); // clone\n};\n\n/**\n * View only a portion of the whole board.\n *\n * @param {int} xOff The X offset.\n * @param {int} yOff The Y offset.\n * @param {int} width The width.\n * @param {int} height The height.\n */\nSetup.prototype.view = function(xOff, yOff, width, height) {\n  this.options.view.xOffset = xOff;\n  this.options.view.yOffset = yOff;\n  this.options.view.width = width;\n  this.options.view.height = height;\n\n  this.options.edge.left = (xOff === 0);\n  this.options.edge.right = (xOff+width == this.options.board.width);\n\n  this.options.edge.top = (yOff === 0);\n  this.options.edge.bottom = (yOff+height == this.options.board.height);\n};\n\n/**\n * Replace default options (non-viewport related)\n *\n * @param {Object} options The new options.\n */\nSetup.prototype.setOptions = function(options) {\n  util.extend(this.options, options);\n};\n\n/**\n * Get {@link Notifier} object created by this class. Can be used to\n * change the board the canvas listens to.\n *\n * @returns {Notifier} Canvas notifier.\n */\nSetup.prototype.getNotifier = function() {\n  return this.notifier;\n};\n\n/**\n * Create Canvas based on current settings. When textures are used,\n * image resources need to be loaded, so the function returns and\n * asynchronously call readyFn after actual initialization.\n *\n * @param {Object} elemId The element id or HTML Node where to create the canvas in.\n * @param {function} readyFn Function to call with canvas once it is ready.\n */\nSetup.prototype.create = function(elemId, readyFn) {\n  var options = util.extend({}, this.options); // create a copy\n\n  var createCallback = function(images) {\n    var jcanvas = new Canvas(elemId, options, images);\n\n    jcanvas.draw(this.board, 0, 0, this.board.width-1, this.board.height-1);\n\n    // Track and group later changes with Notifier\n    this.notifier.addCanvas(jcanvas);\n\n    if(readyFn) readyFn(jcanvas);\n  }.bind(this);\n\n  if(this.options.textures) // at least some textures exist\n    util.loadImages(this.options.textures, createCallback);\n  else // blain BW board\n    createCallback({black:false,white:false,shadow:false,board:false});\n};\n\nexport default Setup;\n","/**\n * SGF loading module.\n * @module sgf\n */\n\nimport Coordinate from './coordinate.js';\nimport Record from './record.js';\nimport C from './constants.js';\n\nvar ERROR; // error holder for sgfParse etc.\n\nvar fieldMap = {\n  'AN': 'annotator',\n  'CP': 'copyright',\n  'DT': 'date',\n  'EV': 'event',\n  'GN': 'gameName',\n  'OT': 'overtime',\n  'RO': 'round',\n  'RE': 'result',\n  'RU': 'rules',\n  'SO': 'source',\n  'TM': 'time',\n  'PC': 'location',\n  'PB': 'black',\n  'PW': 'white',\n  'BR': 'blackRank',\n  'WR': 'whiteRank',\n  'BT': 'blackTeam',\n  'WT': 'whiteTeam'\n};\n\n/*\n * Helper function to handle single coordinates as well as coordinate lists.\n *\n * @param {object} propValues A property value array containing a mix of coordinates (aa) and lists (aa:bb)\n * @returns {array} An array of Coordinate objects matching the given property values.\n */\nfunction explodeSGFList(propValues) {\n  var coords = [];\n\n  for(var i=0, len=propValues.length; i<len; i++) {\n    var val = propValues[i];\n\n    if(val.indexOf(':') == -1) { // single coordinate\n      coords.push(new Coordinate(val));\n    } else {\n      var tuple = val.split(':'), c1, c2, coord;\n\n      c1 = new Coordinate(tuple[0]);\n      c2 = new Coordinate(tuple[1]);\n      coord = new Coordinate();\n\n      for(coord.i=c1.i; coord.i<=c2.i; ++coord.i)\n        for(coord.j=c1.j; coord.j<=c2.j; ++coord.j)\n          coords.push(coord.copy());\n    }\n  }\n\n  return coords;\n}\n\nfunction sgfMove(node, name, values, moveMarks) {\n  var coord, player, opponent, play;\n\n  if(name == 'B') {\n    player = C.BLACK;\n    opponent = C.WHITE;\n  } else if('W') {\n    player = C.WHITE;\n    opponent = C.BLACK;\n  }\n\n  coord = (values[0].length == 2) ? new Coordinate(values[0]) : null;\n\n  // Apparently, IGS wants to use outside-board coordinates for pass\n  if(coord !== null && (coord.i >= node.jboard.width || coord.j >= node.jboard.height))\n    coord = null; // Thank you, IGS\n\n  play = node.jboard.playMove(coord, player);\n  node.info.captures[player] += play.captures.length; // tally captures\n\n  if(moveMarks && play.ko)\n      node.setMark(play.ko, C.MARK.SQUARE);\n  \n  if(play.success && coord !== null) {\n    node.setType(coord, player); // play stone\n    node.setType(play.captures, C.CLEAR); // clear opponent's stones\n    if(moveMarks)\n      node.setMark(coord, C.MARK.CIRCLE);\n  } else ERROR = play.error;\n\n  return play.success;\n}\n\nfunction sgfSetup(node, name, values) {\n  var setupMap = {'AB': C.BLACK, 'AW': C.WHITE, 'AE': C.CLEAR};\n\n  node.setType(explodeSGFList(values), setupMap[name]);\n  return true;\n}\n\nfunction sgfMarker(node, name, values) {\n  var markerMap = {\n    'TW': C.MARK.WHITE_TERRITORY,\n    'TB': C.MARK.BLACK_TERRITORY,\n    'CR': C.MARK.CIRCLE,\n    'TR': C.MARK.TRIANGLE,\n    'MA': C.MARK.CROSS,\n    'SQ': C.MARK.SQUARE\n  };\n\n  node.setMark(explodeSGFList(values), markerMap[name]);\n  return true;\n}\n\nfunction sgfComment(node, name, values) {\n  node.info.comment = values[0];\n  return true;\n}\n\nfunction sgfHandicap(node, name, values) {\n  node.info.handicap = values[0];\n  return true;\n}\n\nfunction sgfLabel(node, name, values) {\n  for(var i=0; i<values.length; i++) {\n    var v = values[i], tuple = v.split(':');\n\n    node.setMark(new Coordinate(tuple[0]), tuple[1]);\n  }\n  return true;\n}\n\nfunction sgfInfo(node, name, values) {\n  var field = fieldMap[name];\n\n  node.info[field] = values[0];\n  return true;\n}\n\nvar SGFProperties = {\n  'B': sgfMove,\n  'W': sgfMove,\n  'AB': sgfSetup,\n  'AW': sgfSetup,\n  'AE': sgfSetup,\n  'C': sgfComment,\n  'LB': sgfLabel,\n  'HA': sgfHandicap,\n  'TW': sgfMarker,\n  'TB': sgfMarker,\n  'CR': sgfMarker,\n  'TR': sgfMarker,\n  'MA': sgfMarker,\n  'SQ': sgfMarker,\n  'AN': sgfInfo,\n  'CP': sgfInfo,\n  'DT': sgfInfo,\n  'EV': sgfInfo,\n  'GN': sgfInfo,\n  'OT': sgfInfo,\n  'RO': sgfInfo,\n  'RE': sgfInfo,\n  'RU': sgfInfo,\n  'SO': sgfInfo,\n  'TM': sgfInfo,\n  'PC': sgfInfo,\n  'PB': sgfInfo,\n  'PW': sgfInfo,\n  'BR': sgfInfo,\n  'WR': sgfInfo,\n  'BT': sgfInfo,\n  'WT': sgfInfo\n};\n\n/*\n * Parse SGF string into object tree representation:\n *\n * tree = { sequence: [ <node(s)> ], leaves: [ <subtree(s), if any> ] }\n *\n * Each node is an object containing property identifiers and associated values in array:\n *\n * node = {'B': ['nn'], 'C': ['This is a comment']}\n *\n * @param {String} sgf The SGF in string format, whitespace allowed.\n * @returns {Object} Root node or false on error. Error stored to ERROR variable.\n */\nfunction parseSGF(sgf) {\n  var tokens, i, len, token, // for loop vars\n      lastBackslash = false, // flag to note if last string ended in escape\n      bracketOpen = -1, // the index where bracket opened\n      processed = [];\n\n  if('a~b'.split(/(~)/).length === 3) {\n    tokens = sgf.split(/([\\[\\]\\(\\);])/); // split into an array at '[', ']', '(', ')', and ';', and include separators in array\n  } else { // Thank you IE for not working\n    var blockStart = 0, delimiters = '[]();';\n\n    tokens = [];\n\n    for(i=0, len=sgf.length; i<len; ++i) {\n      if(delimiters.indexOf(sgf.charAt(i)) !== -1) {\n        if(blockStart < i)\n          tokens.push(sgf.substring(blockStart, i));\n        tokens.push(sgf.charAt(i));\n        blockStart = i+1;\n      }\n    }\n\n    if(blockStart < i) // leftovers\n      tokens.push(sgf.substr(blockStart, i));\n  }\n\n  // process through tokens and push everything into processed, but merge stuff between square brackets into one element, unescaping escaped brackets\n  // i.e. ['(', ';', 'C', '[', 'this is a comment containing brackets ', '[', '\\\\', ']', ']'] becomes:\n  // ['(', ';', 'C', '[', 'this is a comment containing brackets []]']\n  // after this transformation, it's just '(', ')', ';', 'ID', and '[bracket stuff]' elements in the processed array\n  for(i=0, len=tokens.length; i<len; ++i) {\n    token = tokens[i];\n\n    if(bracketOpen == -1) { // handling elements outside property values (i.e. square brackets)\n      token = token.replace(/^\\s+|\\s+$/g, ''); // trim whitespace, it is irrelevant here\n      if(token == '[') // found one\n        bracketOpen = i;\n      else if(token !== '') // we are outside brackets, so just push everything nonempty as it is into 'processed'\n        processed.push(token);\n    } else { // bracket is open, we're now looking for a ] without preceding \\\n      if(token != ']') { // a text segment\n        lastBackslash = (token.charAt(token.length-1) == '\\\\'); // true if string ends in \\\n      } else { // a closing bracket\n        if(lastBackslash) { // it's escaped - we continue\n          lastBackslash = false;\n        } else { // it's not escaped - we close the segment\n          processed.push(tokens.slice(bracketOpen, i+1).join('').replace(/\\\\\\]/g, ']')); // push the whole thing including brackets, and unescape the inside closing brackets\n          bracketOpen = -1;\n        }\n      }\n    }\n  }\n\n  // basic error checking\n  if(processed.length === 0) {\n    ERROR = 'SGF was empty!';\n    return false;\n  } else if(processed[0] != '(' || processed[1] != ';' || processed[processed.length-1] != ')') {\n    ERROR = 'SGF did not start with \\'(;\\' or end with \\')\\'!';\n    return false;\n  }\n\n  // collect 'XY', '[AB]', '[CD]' sequences (properties) in a node into {'XY': ['AB', 'CD']} type of associative array\n  // effectively parsing '(;GM[1]FF[4];B[pd])' into ['(', {'GM': ['1'], 'FF': ['4']}, {'B': ['pd']}, ')']\n\n  // start again with 'tokens' and process into 'processed'\n  tokens = processed;\n  processed = [];\n\n  var node, propertyId = ''; // node under construction, and current property identifier\n\n  // the following code is not strict on format, so let's hope it's well formed\n  for(i=0, len=tokens.length; i<len; ++i) {\n    token = tokens[i];\n\n    if(token == '(' || token == ')') {\n      if(node) { // flush and reset node if necessary\n        if(propertyId !== '' && node[propertyId].length === 0) { // last property was missing value\n          ERROR = 'Missing property value at ' + token + '!';\n          return false;\n        }\n        processed.push(node);\n        node = undefined;\n      }\n\n      processed.push(token); // push this token also\n    } else if(token == ';') { // new node\n      if(node) { // flush if necessary\n        if(propertyId !== '' && node[propertyId].length === 0) { // last property was missing value\n          ERROR = 'Missing property value at ' + token + '!';\n          return false;\n        }\n        processed.push(node);\n      }\n\n      node = {};\n      propertyId = ''; // initialize the new node\n    } else { // it's either a property identifier or a property value\n      if(token.indexOf('[') !== 0) { // it's property identifier\n        if(propertyId !== '' && node[propertyId].length === 0) { // last property was missing value\n          ERROR = 'Missing property value at ' + token + '!';\n          return false;\n        }\n\n        if(token in node) { // duplicate key\n          ERROR = 'Duplicate property identifier ' + token + '!';\n          return false;\n        }\n\n        propertyId = token;\n        node[propertyId] = []; // initialize new property with empty value array\n      } else { // it's property value\n        if(propertyId === '') { // we're missing the identifier\n          ERROR = 'Missing property identifier at ' + token + '!';\n          return false;\n        }\n\n        node[propertyId].push(token.substring(1, token.length-1)); // remove enclosing brackets\n      }\n    }\n  }\n\n  tokens = processed;\n\n  // finally, construct a game tree from '(', ')', and sequence arrays - each leaf is {sequence: [ <list of nodes> ], leaves: [ <list of leaves> ]}\n  var stack = [], currentRoot = {sequence: [], leaves: []}, lastRoot; // we know first element already: '('\n\n  for(i=1, len=tokens.length; i<len-1; ++i) {\n    token = tokens[i];\n\n    if(token == '(') { // enter a subleaf\n      if(currentRoot.sequence.length === 0) { // consecutive parenthesis without node sequence in between will throw an error\n        ERROR = 'SGF contains a game tree without a sequence!';\n        return false;\n      }\n      stack.push(currentRoot); // save current leaf for when we return\n      currentRoot = {sequence: [], leaves: []};\n    } else if(token == ')') { // return from subleaf\n      if(currentRoot.sequence.length === 0) { // consecutive parenthesis without node sequence in between will throw an error\n        ERROR = 'SGF contains a game tree without a sequence!';\n        return false;\n      }\n      lastRoot = currentRoot;\n      currentRoot = stack.pop();\n      currentRoot.leaves.push(lastRoot);\n    } else { // if every '(' is not followed by exactly one array of nodes (as it should), this code fails\n      currentRoot.sequence.push(token);\n    }\n  }\n\n  if(stack.length > 0) {\n    ERROR = 'Invalid number of parentheses in the SGF!';\n    return false;\n  }\n\n  return currentRoot;\n}\n\n/*\n * Apply SGF nodes recursively to create a game tree.\n * @returns true on success, false on error. Error message in ERROR.\n */\nfunction recurseRecord(jrecord, gameTree, moveMarks) {\n  for(var i=0; i<gameTree.sequence.length; i++) {\n    var node = gameTree.sequence[i],\n      jnode = jrecord.createNode(true); // clear parent marks\n\n    for(var key in node) {\n      if(node.hasOwnProperty(key)) {\n        if(!(key in SGFProperties))\n          continue;\n\n        if(!SGFProperties[key](jnode, key, node[key], moveMarks)) {\n          ERROR = 'Error while parsing node ' + key + ': ' + ERROR;\n          return false;\n        }\n      }\n    }\n  }\n\n  for(i=0; i<gameTree.leaves.length; i++) {\n    var subTree = gameTree.leaves[i], snapshot;\n\n    snapshot = jrecord.createSnapshot();\n\n    if(!recurseRecord(jrecord, subTree, moveMarks))\n      return false; // fall through on errors\n\n    jrecord.restoreSnapshot(snapshot);\n  }\n\n  return true;\n}\n\n/*\n * Convert game tree to a record.\n * @returns {Object} Record or false on failure. Error stored in ERROR.\n */\nfunction gameTreeToRecord(gameTree, moveMarks) {\n  var jrecord, root = gameTree.sequence[0], width = 19, height = 19;\n\n  if('SZ' in root) {\n    var size = root.SZ[0];\n\n    if(size.indexOf(':') != -1) {\n      width = parseInt(size.substring(0, size.indexOf(':')));\n      height = parseInt(size.substr(size.indexOf(':')+1));\n    } else width = height = parseInt(size);\n  }\n\n  jrecord = new Record(width, height);\n\n  if(!recurseRecord(jrecord, gameTree, moveMarks))\n    return false;\n\n  jrecord.first(); // rewind to start\n\n  return jrecord;\n}\n\n/**\n * Parse SGF and return {@link Record} object(s).\n *\n * @param {String} sgf The SGF file as a string.\n * @param {bool} moveMarks Create move and ko marks in the record.\n * @returns {Object} Record object, array of them, or string on error.\n */\nexport function load(sgf, moveMarks) {\n  var gameTree = parseSGF(sgf);\n\n  if(gameTree === false)\n    return ERROR;\n\n  if(gameTree.sequence.length === 0) { // potentially multiple records\n    var ret = [];\n\n    if(gameTree.leaves.length === 0)\n      return 'Empty game tree!';\n\n    for(var i=0; i<gameTree.leaves.length; i++) {\n      var rec = gameTreeToRecord(gameTree, moveMarks);\n\n      if(!rec)\n        return ERROR;\n\n      ret.push(rec); // return each leaf as separate record\n    }\n\n    return ret;\n  }\n\n  return gameTreeToRecord(gameTree, moveMarks);\n}\n\nexport default { load };\n","//var request = require('superagent');\nimport C from './constants.js';\n\n/**\n * Automatic div module.\n * @module autodiv\n */\n\nfunction parseMarkup(str) {\n  var lines = str.split('\\n'), data = [];\n\n  // Handle div contents as diagram contents\n  for(var i = 0, len = lines.length; i < len; ++i) {\n    var elems = [], line = lines[i];\n\n    for(var j = 0, len2 = line.length; j < len2; ++j) {\n      switch(line[j]) {\n        case '.':\n          elems.push({type: C.CLEAR}); break;\n        case 'o':\n          elems.push({type: C.WHITE}); break;\n        case 'x':\n          elems.push({type: C.BLACK}); break;\n        case ' ':\n          break; // ignore whitespace\n        default: // assume marker\n          if(!elems.length) break; // no intersection yet\n          // Append to mark so x123 etc. are possible\n          if(elems[elems.length - 1].mark)\n            elems[elems.length - 1].mark += line[j];\n          else\n            elems[elems.length - 1].mark = line[j];\n      }\n    }\n\n    if(elems.length) data.push(elems);\n  }\n\n  return data;\n}\n\n// Array of loaded boards\n//var boards = [];\n\n// Available attributes:\n// data-jgostyle: Evaluated and used as board style\n// data-jgosize: Used as board size unless data-jgosgf is defined\n// data-jgoview: Used to define viewport\nfunction process(JGO, div) {\n  // Handle special jgo-* attributes\n  var style, width, height, TL, BR; // last two are viewport\n\n  if(div.getAttribute('data-jgostyle')) {\n    /*jshint evil:true  */\n    style = eval(div.getAttribute('data-jgostyle'));\n  } else style = JGO.BOARD.medium;\n\n  if(div.getAttribute('data-jgosize')) {\n    var size = div.getAttribute('data-jgosize');\n\n    if(size.indexOf('x') != -1) {\n      width = parseInt(size.substring(0, size.indexOf('x')));\n      height = parseInt(size.substr(size.indexOf('x')+1));\n    } else width = height = parseInt(size);\n  }\n\n  //if(div.getAttribute('data-jgosgf'))\n\n  var data = parseMarkup(div.innerHTML);\n  div.innerHTML = '';\n\n  if(!width) { // Size still missing\n    if(!data.length) return; // no size or data, no board\n\n    height = data.length;\n    width = data[0].length;\n  }\n\n  var jboard = new JGO.Board(width, height);\n  var jsetup = new JGO.Setup(jboard, style);\n\n  if(div.getAttribute('data-jgoview')) {\n    var tup = div.getAttribute('data-jgoview').split('-');\n    TL = jboard.getCoordinate(tup[0]);\n    BR = jboard.getCoordinate(tup[1]);\n  } else {\n    TL = new JGO.Coordinate(0,0);\n    BR = new JGO.Coordinate(width-1, height-1);\n  }\n\n  jsetup.view(TL.i, TL.j, width-TL.i, height-TL.j);\n\n  var c = new JGO.Coordinate();\n\n  for(c.j = TL.j; c.j <= BR.j; ++c.j) {\n    for(c.i = TL.i; c.i <= BR.i; ++c.i) {\n      var elem = data[c.j - TL.j][c.i - TL.i];\n      jboard.setType(c, elem.type);\n      if(elem.mark) jboard.setMark(c, elem.mark);\n    }\n  }\n\n  jsetup.create(div);\n}\n\n/**\n * Find all div elements with class 'jgoboard' and initialize them.\n */\nexport function init(document, JGO) {\n  var matches = document.querySelectorAll('div.jgoboard');\n\n  for(var i = 0, len = matches.length; i < len; ++i)\n    process(JGO, matches[i]);\n}\n\nexport default { init };\n","import JGO from './constants.js'; // base for JGO object\nimport Coordinate from './coordinate.js';\nimport Canvas from './canvas.js';\nimport Node from './node.js';\nimport Notifier from './notifier.js';\nimport Record from './record.js';\nimport Setup from './setup.js';\nimport Stones from './stones.js';\nimport Board from './board.js';\nimport * as util from './util.js';\nimport sgf from './sgf.js';\nimport auto from './auto.js';\n\n// Assemble the JGO object\nJGO.Coordinate = Coordinate;\nJGO.Canvas = Canvas;\nJGO.Node = Node;\nJGO.Notifier = Notifier;\nJGO.Record = Record;\nJGO.Setup = Setup;\nJGO.Stones = Stones;\nJGO.Board = Board;\nJGO.util = util;\nJGO.sgf = sgf;\nJGO.auto = auto;\n\n// Named exports for tree-shaking\nexport {\n  Coordinate,\n  Canvas,\n  Node,\n  Notifier,\n  Record,\n  Setup,\n  Stones,\n  Board,\n  util,\n  sgf,\n  auto\n};\n\nexport default JGO;\n","import JGO from './JGO/index.js';\n\n// Export for UMD builds (will be global in browser)\nif (typeof window !== 'undefined') {\n  window.JGO = JGO;\n}\n\n// Also export as default for ESM usage\nexport default JGO;\n\n// Re-export named exports for tree-shaking\nexport * from './JGO/index.js';\n"],"names":["SGFLetters","split","Coordinate","i","j","this","toLowerCase","indexOf","substr","loadImages","sources","callback","images","imagesLeft","src","hasOwnProperty","countdown","Image","onload","getHandicapCoordinates","size","num","places","offset","step","coords","n","length","Math","floor","push","extend","dest","key","prototype","equals","c","toString","copy","INTERSECTION","CLEAR","BLACK","WHITE","DIM_BLACK","DIM_WHITE","MARK","NONE","SELECTED","SQUARE","TRIANGLE","CIRCLE","CROSS","BLACK_TERRITORY","WHITE_TERRITORY","COORDINATES","JGO","Stones","options","stoneR","stone","radius","gridX","grid","x","gridY","markX","markY","circleR","triangleR","drawStone","ctx","type","ox","oy","scale","C","black","white","drawImage","width","height","round","fillStyle","beginPath","arc","PI","fill","strokeStyle","stroke","drawShadow","shadow","drawMark","mark","rect","moveTo","lineTo","r","cos","sin","globalAlpha","fillRect","fillText","Canvas","elem","opt","document","getElementById","canvas","createElement","padLeft","edge","left","padding","normal","clipped","padRight","right","padTop","top","padBottom","bottom","marginLeft","margin","marginRight","marginTop","marginBottom","boardWidth","view","boardHeight","y","listeners","click","mousemove","mouseout","getCoordinate","pageX","pageY","bounds","getBoundingClientRect","scaledX","scaledY","xOffset","yOffset","bind","onclick","ev","clientX","clientY","l","call","lastMove","onmousemove","onmouseout","appendChild","getContext","util.extend","stones","color","board","save","shadowColor","boardShadow","shadowBlur","blur","shadowOffsetX","offX","offY","clipTop","clipLeft","clipBottom","clipRight","clip","border","lineWidth","restore","gridTop","gridLeft","smt","smooth","borderWidth","stars","points","font","coordinates","textAlign","textBaseline","backup","w","h","max","min","e","console","log","getX","getY","draw","jboard","i1","j1","i2","j2","clearFunc","isLabel","clearW","clearH","each","test","xOff","yOff","markColor","dimAlpha","blackColor","whiteColor","clearColor","addListener","event","Node","parent","info","children","changes","captures","clearParentMarks","item","setMark","setType","val","Array","len","old","getType","getMark","apply","revert","Notifier","updateScheduled","canvases","changeFunc","coord","coordinate","setTimeout","changeBoard","removeListener","addCanvas","jcanvas","Board","marks","stoneArr","markArr","func","index","splice","s","toUpperCase","parseInt","clear","t","oldVal","newVal","forEach","m","ret","getAdjacent","filter","hasType","getGroup","overrideType","seen","group","neighbors","queue","shift","concat","getRaw","setRaw","raw","clone","playMove","ko","adjacent","oppType","captured","success","errorMsg","g","Record","root","current","getBoard","getCurrentNode","getRootNode","createNode","node","next","variation","previous","getVariation","setVariation","getVariations","first","createSnapshot","restoreSnapshot","normalize","maxLen","maxI","Setup","boardOptions","defaults","notifier","ERROR","setOptions","getNotifier","create","elemId","readyFn","createCallback","textures","util.loadImages","fieldMap","AN","CP","DT","EV","GN","OT","RO","RE","RU","SO","TM","PC","PB","PW","BR","WR","BT","WT","explodeSGFList","propValues","c1","c2","tuple","sgfMove","name","values","moveMarks","player","play","error","sgfSetup","setupMap","AB","AW","AE","sgfMarker","markerMap","TW","TB","CR","TR","MA","SQ","sgfComment","comment","sgfHandicap","handicap","sgfLabel","sgfInfo","field","SGFProperties","B","W","LB","HA","parseSGF","sgf","tokens","token","lastBackslash","bracketOpen","processed","blockStart","charAt","substring","replace","slice","join","propertyId","lastRoot","stack","currentRoot","sequence","leaves","pop","recurseRecord","jrecord","gameTree","jnode","snapshot","subTree","gameTreeToRecord","SZ","load","rec","parseMarkup","str","lines","data","elems","line","len2","process","div","style","TL","getAttribute","eval","BOARD","medium","innerHTML","jsetup","tup","init","matches","querySelectorAll","auto","util","window"],"mappings":"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"}