/*! jGoBoard - (c) Joonas Pihlajamaa - Licensed under CC-BY-NC-4.0 */
const SGFLetters="abcdefghijklmnopqrstuvwxyz".split(""),Coordinate=function(t,e){if(void 0!==t)if(void 0!==e)this.i=t,this.j=e;else{if(this.i=0,this.j=0,"string"!=typeof t)return;t=t.toLowerCase(),this.i=SGFLetters.indexOf(t.substr(0,1)),this.j=SGFLetters.indexOf(t.substr(1))}else this.i=0,this.j=0};function loadImages(t,e){var i={},r=0;for(var s in t)t.hasOwnProperty(s)&&t[s]&&r++;var o=function(){--r<=0&&e(i)};for(s in t)t.hasOwnProperty(s)&&t[s]&&(i[s]=new Image,i[s].onload=o,i[s].src=t[s])}function getHandicapCoordinates(t,e){var i=[[],[],[3,7],[3,7,9],[1,3,7,9],[1,3,5,7,9],[1,3,4,6,7,9],[1,3,4,5,6,7,9],[1,2,3,4,6,7,8,9],[1,2,3,4,5,6,7,8,9]][e],r=t<=9?2:3,s=(t-1)/2-r,o=[];if(i)for(var n=0;n<i.length;n++){var h=(i[n]-1)%3,a=Math.floor((i[n]-1)/3);o.push(new Coordinate(r+h*s,r+a*s))}return o}function extend(t,e){for(var i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?(t[i]&&"object"==typeof t[i]||(t[i]={}),extend(t[i],e[i])):t[i]=e[i]);return t}Coordinate.prototype.equals=function(t){return t.i==this.i&&t.j==this.j},Coordinate.prototype.toString=function(){return SGFLetters[this.i]+SGFLetters[this.j]},Coordinate.prototype.copy=function(){return new Coordinate(this.i,this.j)};const util=/* @__PURE__ */Object.freeze(/* @__PURE__ */Object.defineProperty({__proto__:null,extend:extend,getHandicapCoordinates:getHandicapCoordinates,loadImages:loadImages},Symbol.toStringTag,{value:"Module"})),INTERSECTION={CLEAR:0,BLACK:1,WHITE:2,DIM_BLACK:3,DIM_WHITE:4},MARK={NONE:"",SELECTED:"^",SQUARE:"#",TRIANGLE:"/",CIRCLE:"0",CROSS:"*",BLACK_TERRITORY:"-",WHITE_TERRITORY:"+"},COORDINATES="ABCDEFGHJKLMNOPQRSTUVWXYZ".split(""),JGO={INTERSECTION:INTERSECTION,MARK:MARK,COORDINATES:COORDINATES};extend(JGO,INTERSECTION);var Stones=function(t,e){this.stoneR=t.stone.radius,this.gridX=t.grid.x,this.gridY=t.grid.x,this.markX=1.1*this.stoneR,this.markY=1.1*this.stoneR,this.circleR=.5*this.stoneR,this.triangleR=.9*this.stoneR,this.images=e};Stones.prototype.drawStone=function(t,e,i,r,s){s||(s=1);var o=e==JGO.BLACK||e==JGO.DIM_BLACK?this.images.black:this.images.white;o?t.drawImage(o,0,0,o.width,o.height,Math.round(i-o.width/2*s),Math.round(r-o.height/2*s),o.width*s,o.height*s):(t.fillStyle=e==JGO.WHITE?"#FFFFFF":"#000000",t.beginPath(),t.arc(i,r,this.stoneR*s,2*Math.PI,!1),t.fill(),e==JGO.WHITE&&(t.strokeStyle="#000000",t.stroke()))},Stones.prototype.drawShadow=function(t,e,i,r){var s=this.images.shadow;s&&(r||(r=1),t.drawImage(s,0,0,s.width,s.height,Math.round(e-s.width/2*r),Math.round(i-s.height/2*r),s.width*r,s.height*r))},Stones.prototype.drawMark=function(t,e,i,r){switch(e){case JGO.MARK.SQUARE:t.beginPath(),t.rect(i-this.markX/2,r-this.markY/2,this.markX,this.markY),t.stroke();break;case JGO.MARK.CROSS:t.beginPath(),t.moveTo(i-this.markX/2,r+this.markY/2),t.lineTo(i+this.markX/2,r-this.markY/2),t.moveTo(i-this.markX/2,r-this.markY/2),t.lineTo(i+this.markX/2,r+this.markY/2),t.stroke();break;case JGO.MARK.TRIANGLE:t.beginPath();for(var s=0;s<3;s++)t.moveTo(i+this.triangleR*Math.cos(Math.PI*(.5+2*s/3)),r-this.triangleR*Math.sin(Math.PI*(.5+2*s/3))),t.lineTo(i+this.triangleR*Math.cos(Math.PI*(.5+2*(s+1)/3)),r-this.triangleR*Math.sin(Math.PI*(.5+2*(s+1)/3)));t.stroke();break;case JGO.MARK.CIRCLE:t.beginPath(),t.arc(i,r,this.circleR,2*Math.PI,!1),t.stroke();break;case JGO.MARK.BLACK_TERRITORY:t.globalAlpha=1,this.drawStone(t,JGO.BLACK,i,r,.5);break;case JGO.MARK.WHITE_TERRITORY:t.globalAlpha=1,this.drawStone(t,JGO.WHITE,i,r,.5);break;case JGO.MARK.SELECTED:t.globalAlpha=.5,t.fillStyle="#8080FF",t.fillRect(i-this.gridX/2,r-this.gridY/2,this.gridX,this.gridY);break;default:t.fillText(e,i,r)}};var Canvas=function(t,e,i){"string"==typeof t&&(t=document.getElementById(t));var r,s,o=document.createElement("canvas"),n=e.edge.left?e.padding.normal:e.padding.clipped,h=e.edge.right?e.padding.normal:e.padding.clipped,a=e.edge.top?e.padding.normal:e.padding.clipped,d=e.edge.bottom?e.padding.normal:e.padding.clipped;this.marginLeft=e.edge.left?e.margin.normal:e.margin.clipped,this.marginRight=e.edge.right?e.margin.normal:e.margin.clipped,this.marginTop=e.edge.top?e.margin.normal:e.margin.clipped,this.marginBottom=e.edge.bottom?e.margin.normal:e.margin.clipped,this.boardWidth=n+h+e.grid.x*e.view.width,this.boardHeight=a+d+e.grid.y*e.view.height,this.width=o.width=this.marginLeft+this.marginRight+this.boardWidth,this.height=o.height=this.marginTop+this.marginBottom+this.boardHeight,this.listeners={click:[],mousemove:[],mouseout:[]},this.getCoordinate=function(t,i){var r=o.getBoundingClientRect(),s=(t-r.left)*o.width/(r.right-r.left),h=(i-r.top)*o.height/(r.bottom-r.top);return new Coordinate(Math.floor((s-this.marginLeft-n)/e.grid.x)+e.view.xOffset,Math.floor((h-this.marginTop-a)/e.grid.y)+e.view.yOffset)}.bind(this),o.onclick=function(t){for(var e=this.getCoordinate(t.clientX,t.clientY),i=this.listeners.click,r=0;r<i.length;r++)i[r].call(this,e.copy(),t)}.bind(this);var c=new Coordinate(-1,-1);if(o.onmousemove=function(t){if(this.listeners.mousemove.length){var e=this.getCoordinate(t.clientX,t.clientY),i=this.listeners.mousemove;if((e.i<this.opt.view.xOffset||e.i>=this.opt.view.xOffset+this.opt.view.width)&&(e.i=-1),(e.j<this.opt.view.yOffset||e.j>=this.opt.view.yOffset+this.opt.view.height)&&(e.j=-1),!c.equals(e)){c=e.copy();for(var r=0;r<i.length;r++)i[r].call(this,e.copy(),t)}}}.bind(this),o.onmouseout=function(t){for(var e=this.listeners.mouseout,i=0;i<e.length;i++)e[i].call(this,t)}.bind(this),t.appendChild(o),this.ctx=o.getContext("2d"),this.opt=extend({},e),this.stones=new Stones(e,i),this.images=i,this.ctx.fillStyle=e.margin.color,this.ctx.fillRect(0,0,o.width,o.height),this.images.board){this.ctx.save(),this.ctx.shadowColor=e.boardShadow.color,this.ctx.shadowBlur=e.boardShadow.blur,this.ctx.shadowOffsetX=e.boardShadow.offX,this.ctx.shadowOffsetX=e.boardShadow.offY;var g=e.edge.top?0:this.marginTop,f=e.edge.left?0:this.marginLeft,p=e.edge.bottom?0:this.marginBottom,l=e.edge.right?0:this.marginRight;this.ctx.beginPath(),this.ctx.rect(f,g,o.width-f-l,o.height-g-p),this.ctx.clip(),this.ctx.drawImage(this.images.board,0,0,this.boardWidth,this.boardHeight,this.marginLeft,this.marginTop,this.boardWidth,this.boardHeight),this.ctx.strokeStyle=e.border.color,this.ctx.lineWidth=e.border.lineWidth,this.ctx.beginPath(),this.ctx.rect(this.marginLeft,this.marginTop,this.boardWidth,this.boardHeight),this.ctx.stroke(),this.ctx.restore()}this.gridTop=this.marginTop+a+e.grid.y/2,this.gridLeft=this.marginLeft+n+e.grid.x/2,this.ctx.strokeStyle=e.grid.color;var u=this.opt.grid.smooth;for(r=0;r<e.view.width;r++)0===r&&e.edge.left||r+1==e.view.width&&e.edge.right?this.ctx.lineWidth=e.grid.borderWidth:this.ctx.lineWidth=e.grid.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(u+this.gridLeft+e.grid.x*r,u+this.gridTop-(e.edge.top?0:e.grid.y/2+a/2)),this.ctx.lineTo(u+this.gridLeft+e.grid.x*r,u+this.gridTop+e.grid.y*(e.view.height-1)+(e.edge.bottom?0:e.grid.y/2+d/2)),this.ctx.stroke();for(r=0;r<e.view.height;r++)0===r&&e.edge.top||r+1==e.view.height&&e.edge.bottom?this.ctx.lineWidth=e.grid.borderWidth:this.ctx.lineWidth=e.grid.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(u+this.gridLeft-(e.edge.left?0:e.grid.x/2+n/2),u+this.gridTop+e.grid.y*r),this.ctx.lineTo(u+this.gridLeft+e.grid.x*(e.view.width-1)+(e.edge.right?0:e.grid.x/2+h/2),u+this.gridTop+e.grid.y*r),this.ctx.stroke();if(e.stars.points){var v=(e.board.width-1)/2-e.stars.offset;for(s=0;s<3;s++)for(r=0;r<3;r++){if(1==s&&1==r){if(e.stars.points%2==0)continue}else if(1==r||1==s){if(e.stars.points<8)continue}else if(e.stars.points<4)continue;var m=e.stars.offset+r*v-e.view.xOffset,w=e.stars.offset+s*v-e.view.yOffset;m<0||w<0||m>=e.view.width||w>=e.view.height||(this.ctx.beginPath(),this.ctx.arc(u+this.gridLeft+m*e.grid.x,u+this.gridTop+w*e.grid.y,e.stars.radius,2*Math.PI,!1),this.ctx.fillStyle=e.grid.color,this.ctx.fill())}}for(this.ctx.font=e.coordinates.font,this.ctx.fillStyle=e.coordinates.color,this.ctx.textAlign="center",this.ctx.textBaseline="middle",r=0;r<e.view.width;r++)e.coordinates&&e.coordinates.top&&this.ctx.fillText(JGO.COORDINATES[r+e.view.xOffset],this.gridLeft+e.grid.x*r,this.marginTop/2),e.coordinates&&e.coordinates.bottom&&this.ctx.fillText(JGO.COORDINATES[r+e.view.xOffset],this.gridLeft+e.grid.x*r,o.height-this.marginBottom/2);for(r=0;r<e.view.height;r++)e.coordinates&&e.coordinates.left&&this.ctx.fillText(""+(e.board.height-e.view.yOffset-r),this.marginLeft/2,this.gridTop+e.grid.y*r),e.coordinates&&e.coordinates.right&&this.ctx.fillText(""+(e.board.height-e.view.yOffset-r),o.width-this.marginRight/2,this.gridTop+e.grid.y*r);this.backup=document.createElement("canvas"),this.backup.width=o.width,this.backup.height=o.height,this.backup.getContext("2d").drawImage(o,0,0,o.width,o.height,0,0,o.width,o.height),this.ctx.beginPath(),this.ctx.rect(this.marginLeft,this.marginTop,this.boardWidth,this.boardHeight),this.ctx.clip(),this.images.black&&this.ctx.drawImage(this.images.black,10,10),this.images.white&&this.ctx.drawImage(this.images.white,10,10),this.images.shadow&&this.ctx.drawImage(this.images.shadow,10,10),this.restore(this.marginLeft,this.marginTop,this.boardWidth,this.boardHeight)};Canvas.prototype.restore=function(t,e,i,r){t=Math.floor(t),e=Math.floor(e),t=Math.max(t,0),e=Math.max(e,0),i=Math.min(i,this.backup.width-t),r=Math.min(r,this.backup.height-e);try{this.ctx.drawImage(this.backup,t,e,i,r,t,e,i,r)}catch(s){console.log(s)}},Canvas.prototype.getX=function(t){return this.gridLeft+this.opt.grid.x*t},Canvas.prototype.getY=function(t){return this.gridTop+this.opt.grid.y*t},Canvas.prototype.draw=function(t,e,i,r,s){if(e=this.opt.view.xOffset,i=this.opt.view.yOffset,r=this.opt.view.xOffset+this.opt.view.width-1,s=this.opt.view.yOffset+this.opt.view.height-1,!(r<e||s<i)){var o=this.getX(e-this.opt.view.xOffset)-this.opt.grid.x,n=this.getY(i-this.opt.view.yOffset)-this.opt.grid.y,h=this.opt.grid.x*(r-e+2),a=this.opt.grid.y*(s-i+2);this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(o,n,h,a),this.ctx.clip(),this.restore(o,n,h,a),e=Math.max(e-1,this.opt.view.xOffset),i=Math.max(i-1,this.opt.view.yOffset),r=Math.min(r+1,this.opt.view.xOffset+this.opt.view.width-1),s=Math.min(s+1,this.opt.view.yOffset+this.opt.view.height-1);var d,c=/^[a-zA-Z1-9]/,g=this.opt.stone.radius,f=1.5*g,p=1.2*g;this.images.board?d=function(t,e){this.ctx.drawImage(this.images.board,t-this.marginLeft-f/2,e-this.marginTop-p/2,f,p,t-f/2,e-p/2,f,p)}.bind(this):(this.ctx.fillStyle=this.opt.margin.color,d=function(t,e){this.ctx.fillRect(t-f/2,e-p/2,f,p)}.bind(this)),t.each(function(t,e,i){var r=this.getX(t.i-this.opt.view.xOffset),s=this.getY(t.j-this.opt.view.yOffset);e==JGO.CLEAR&&i&&c.test(i)&&d(r,s)}.bind(this),e,i,r,s),t.each(function(t,e){var i=this.getX(t.i-this.opt.view.xOffset),r=this.getY(t.j-this.opt.view.yOffset);e!=JGO.BLACK&&e!=JGO.WHITE||this.stones.drawShadow(this.ctx,this.opt.shadow.xOff+i,this.opt.shadow.yOff+r)}.bind(this),e,i,r,s),t.each(function(t,e,i){var r,s=this.getX(t.i-this.opt.view.xOffset),o=this.getY(t.j-this.opt.view.yOffset);switch(e){case JGO.BLACK:case JGO.DIM_BLACK:this.ctx.globalAlpha=e==JGO.BLACK?1:this.opt.stone.dimAlpha,this.stones.drawStone(this.ctx,e,s,o),r=this.opt.mark.blackColor;break;case JGO.WHITE:case JGO.DIM_WHITE:this.ctx.globalAlpha=e==JGO.WHITE?1:this.opt.stone.dimAlpha,this.stones.drawStone(this.ctx,e,s,o),r=this.opt.mark.whiteColor;break;default:this.ctx.globalAlpha=1,r=this.opt.mark.clearColor}this.ctx.lineWidth=this.opt.mark.lineWidth,this.ctx.strokeStyle=r,this.ctx.font=this.opt.mark.font,this.ctx.fillStyle=r,this.ctx.textAlign="center",this.ctx.textBaseline="middle",i&&this.stones.drawMark(this.ctx,i,s,o)}.bind(this),e,i,r,s),this.ctx.restore()}},Canvas.prototype.addListener=function(t,e){this.listeners[t].push(e)};const Node=function(t,e,i){this.jboard=t,this.parent=e,this.info=i?extend({},i):{},this.children=[],this.changes=[],e?(e.children.push(this),this.info.captures=extend({},e.info.captures)):this.info.captures={1:0,2:0}};Node.prototype.clearParentMarks=function(){if(this.parent)for(var t=this.parent.changes.length-1;t>=0;t--){var e=this.parent.changes[t];"mark"in e&&this.setMark(e.c,JGO.MARK.NONE)}},Node.prototype.setType=function(t,e){if(t instanceof Array)for(var i=0,r=t.length;i<r;++i)this.setType(t[i],e);else this.changes.push({c:t.copy(),type:e,old:this.jboard.getType(t)}),this.jboard.setType(t,e)},Node.prototype.setMark=function(t,e){if(t instanceof Array)for(var i=0,r=t.length;i<r;++i)this.setMark(t[i],e);else this.changes.push({c:t.copy(),mark:e,old:this.jboard.getMark(t)}),this.jboard.setMark(t,e)},Node.prototype.apply=function(){for(var t=0;t<this.changes.length;t++){var e=this.changes[t];"type"in e?this.jboard.setType(e.c,e.type):this.jboard.setMark(e.c,e.mark)}},Node.prototype.revert=function(){for(var t=this.changes.length-1;t>=0;t--){var e=this.changes[t];"type"in e?this.jboard.setType(e.c,e.old):this.jboard.setMark(e.c,e.old)}};const Notifier=function(t){this.updateScheduled=!1,this.canvases=[],this.board=t,this.changeFunc=function(t){var e=t.coordinate;if(this.updateScheduled)return this.min.i=Math.min(this.min.i,e.i),this.min.j=Math.min(this.min.j,e.j),this.max.i=Math.max(this.max.i,e.i),void(this.max.j=Math.max(this.max.j,e.j));this.min=e.copy(),this.max=e.copy(),this.updateScheduled=!0,setTimeout(function(){for(var t=0;t<this.canvases.length;t++)this.canvases[t].draw(this.board,this.min.i,this.min.j,this.max.i,this.max.j);this.updateScheduled=!1}.bind(this),0)}.bind(this),this.board.addListener(this.changeFunc)};Notifier.prototype.changeBoard=function(t){this.board.removeListener(this.changeFunc),this.board=t,this.board.addListener(this.changeFunc);for(var e=0;e<this.canvases.length;e++)this.canvases[e].draw(this.board,0,0,this.board.width,this.board.height)},Notifier.prototype.addCanvas=function(t){this.canvases.push(t)};const Board=function(t,e){this.width=t,this.height=void 0!==e?e:this.width,this.listeners=[],this.stones=[],this.marks=[];for(var i=0;i<this.width;++i){for(var r=[],s=[],o=0;o<this.height;++o)r.push(JGO.CLEAR),s.push(JGO.MARK.NONE);this.stones.push(r),this.marks.push(s)}};Board.prototype.addListener=function(t){this.listeners.push(t)},Board.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);-1!=e&&this.listeners.splice(e,1)},Board.prototype.getCoordinate=function(t){return new Coordinate(JGO.COORDINATES.indexOf(t.toUpperCase().substr(0,1)),this.height-parseInt(t.substr(1)))},Board.prototype.toString=function(t){return JGO.COORDINATES[t.i]+(this.height-t.j)},Board.prototype.each=function(t,e,i,r,s){var o=new Coordinate;for(void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=this.width-1),void 0===s&&(s=this.height-1),o.j=i;o.j<=s;o.j++)for(o.i=e;o.i<=r;o.i++)t(o.copy(),this.stones[o.i][o.j],this.marks[o.i][o.j])},Board.prototype.clear=function(){this.each(function(t){this.setType(t,JGO.CLEAR),this.setMark(t,JGO.MARK.NONE)}.bind(this))},Board.prototype.setType=function(t,e){if(t instanceof Coordinate){var i=this.stones[t.i][t.j];if(i==e)return;this.stones[t.i][t.j]=e;var r={type:"type",coordinate:t,board:this,oldVal:i,newVal:e};this.listeners.forEach(function(t){t(r)})}else if(t instanceof Array)for(var s=0,o=t.length;s<o;++s)this.setType(t[s],e)},Board.prototype.setMark=function(t,e){if(t instanceof Coordinate){var i=this.marks[t.i][t.j];if(i==e)return;this.marks[t.i][t.j]=e;var r={type:"mark",coordinate:t,board:this,oldVal:i,newVal:e};this.listeners.forEach(function(t){t(r)})}else if(t instanceof Array)for(var s=0,o=t.length;s<o;++s)this.setMark(t[s],e)},Board.prototype.getType=function(t){var e;if(t instanceof Coordinate)e=this.stones[t.i][t.j];else if(t instanceof Array){e=[];for(var i=0,r=t.length;i<r;++i)e.push(this.stones[t[i].i][t[i].j])}return e},Board.prototype.getMark=function(t){var e;if(t instanceof Coordinate)e=this.marks[t.i][t.j];else if(t instanceof Array){e=[];for(var i=0,r=t.length;i<r;++i)e.push(this.marks[t[i].i][t[i].j])}return e},Board.prototype.getAdjacent=function(t){var e=[],i=t.i,r=t.j;return i>0&&e.push(new Coordinate(i-1,r)),i+1<this.width&&e.push(new Coordinate(i+1,r)),r>0&&e.push(new Coordinate(i,r-1)),r+1<this.height&&e.push(new Coordinate(i,r+1)),e},Board.prototype.filter=function(t,e){for(var i=[],r=0,s=t.length;r<s;++r)this.stones[t[r].i][t[r].j]==e&&i.push(t[r]);return i},Board.prototype.hasType=function(t,e){for(var i=0,r=t.length;i<r;++i)if(this.stones[t[i].i][t[i].j]==e)return!0;return!1},Board.prototype.getGroup=function(t,e){var i=e||this.getType(t),r={},s=[t.copy()],o=[],n=this.getAdjacent(t);for(r[t.toString()]=!0;n.length;){var h=n.shift();h.toString()in r||(r[h.toString()]=!0,this.getType(h)==i?(s.push(h),n=n.concat(this.getAdjacent(h))):o.push(h))}return{group:s,neighbors:o}},Board.prototype.getRaw=function(){return{width:this.width,height:this.height,stones:extend({},this.stones),marks:extend({},this.marks)}},Board.prototype.setRaw=function(t){this.width=t.width,this.height=t.height,this.stones=t.stones,this.marks=t.marks},Board.prototype.clone=function(){var t=new Board;return t.setRaw(this.getRaw()),t},Board.prototype.playMove=function(t,e,i){var r,s=e==JGO.BLACK?JGO.WHITE:JGO.BLACK,o=[],n={};if(!t)return{success:!0,captures:[],ko:!1};if(this.getType(t)!=JGO.CLEAR)return{success:!1,errorMsg:"Cannot play on existing stone!"};if(i&&t.equals(i))return{success:!1,errorMsg:"Cannot retake ko immediately!"};r=this.getAdjacent(t);for(var h=0;h<r.length;h++){var a=r[h];if(!(a.toString()in n)&&this.getType(a)==s){var d=this.getGroup(a);if(1===this.filter(d.neighbors,JGO.CLEAR).length){o=o.concat(d.group);for(var c=0;c<d.group.length;c++)n[d.group[c].toString()]=!0}}}return 0!==o.length||this.hasType(this.getGroup(t,e).neighbors,JGO.CLEAR)?1==o.length&&0===this.filter(r,JGO.CLEAR).length&&0===this.filter(r,e).length?{success:!0,captures:o,ko:o[0].copy()}:{success:!0,captures:o,ko:!1}:{success:!1,errorMsg:"Suicide is not allowed!"}};var Record=function(t,e){this.jboard=new Board(t,e||t),this.root=this.current=null,this.info={}};Record.prototype.getBoard=function(){return this.jboard},Record.prototype.getCurrentNode=function(){return this.current},Record.prototype.getRootNode=function(){return this.root},Record.prototype.createNode=function(t,e){var i=new Node(this.jboard,this.current,e);return t&&i.clearParentMarks(),null===this.root&&(this.root=i),this.current=i},Record.prototype.next=function(t){return null===this.current?null:(t||(t=0),t>=this.current.children.length?null:(this.current=this.current.children[t],this.current.apply(this.jboard),this.current))},Record.prototype.previous=function(){return null===this.current||null===this.current.parent?null:(this.current.revert(this.jboard),this.current=this.current.parent,this.current)},Record.prototype.getVariation=function(){return null===this.current||null===this.current.parent?0:this.current.parent.children.indexOf(this.current)},Record.prototype.setVariation=function(t){return null===this.previous()?null:this.next(t)},Record.prototype.getVariations=function(){return null===this.current||null===this.current.parent?1:this.current.parent.children.length},Record.prototype.first=function(){return this.current=this.root,this.jboard.clear(),null!==this.current&&this.current.apply(this.jboard),this.current},Record.prototype.createSnapshot=function(){return{jboard:this.jboard.getRaw(),current:this.current}},Record.prototype.restoreSnapshot=function(t){this.jboard.setRaw(t.jboard),this.current=t.current},Record.prototype.normalize=function(t){var e,i,r=0,s=0;for(t||(t=this.getRootNode()),e=0;e<t.children.length;e++)r<(i=this.normalize(t.children[e]))&&(r=i,s=e);return s&&(e=t.children[0],t.children[0]=t.children[s],t.children[s]=e),r+1};var Setup=function(t,e){var i={margin:{color:"white"},edge:{top:!0,bottom:!0,left:!0,right:!0},coordinates:{top:!0,bottom:!0,left:!0,right:!0},stars:{points:0},board:{width:t.width,height:t.height},view:{xOffset:0,yOffset:0,width:t.width,height:t.height}};if(t.width==t.height)switch(t.width){case 9:i.stars.points=5,i.stars.offset=2;break;case 13:case 19:i.stars.points=9,i.stars.offset=3}this.board=t,this.notifier=new Notifier(this.board),this.options=extend(i,e)},ERROR;Setup.prototype.view=function(t,e,i,r){this.options.view.xOffset=t,this.options.view.yOffset=e,this.options.view.width=i,this.options.view.height=r,this.options.edge.left=0===t,this.options.edge.right=t+i==this.options.board.width,this.options.edge.top=0===e,this.options.edge.bottom=e+r==this.options.board.height},Setup.prototype.setOptions=function(t){extend(this.options,t)},Setup.prototype.getNotifier=function(){return this.notifier},Setup.prototype.create=function(t,e){var i=extend({},this.options),r=function(r){var s=new Canvas(t,i,r);s.draw(this.board,0,0,this.board.width-1,this.board.height-1),this.notifier.addCanvas(s),e&&e(s)}.bind(this);this.options.textures?loadImages(this.options.textures,r):r({black:!1,white:!1,shadow:!1,board:!1})};var fieldMap={AN:"annotator",CP:"copyright",DT:"date",EV:"event",GN:"gameName",OT:"overtime",RO:"round",RE:"result",RU:"rules",SO:"source",TM:"time",PC:"location",PB:"black",PW:"white",BR:"blackRank",WR:"whiteRank",BT:"blackTeam",WT:"whiteTeam"};function explodeSGFList(t){for(var e=[],i=0,r=t.length;i<r;i++){var s=t[i];if(-1==s.indexOf(":"))e.push(new Coordinate(s));else{var o,n,h,a=s.split(":");for(o=new Coordinate(a[0]),n=new Coordinate(a[1]),(h=new Coordinate).i=o.i;h.i<=n.i;++h.i)for(h.j=o.j;h.j<=n.j;++h.j)e.push(h.copy())}}return e}function sgfMove(t,e,i,r){var s,o,n;return"B"==e?(o=JGO.BLACK,JGO.WHITE):(o=JGO.WHITE,JGO.BLACK),null!==(s=2==i[0].length?new Coordinate(i[0]):null)&&(s.i>=t.jboard.width||s.j>=t.jboard.height)&&(s=null),n=t.jboard.playMove(s,o),t.info.captures[o]+=n.captures.length,r&&n.ko&&t.setMark(n.ko,JGO.MARK.SQUARE),n.success&&null!==s?(t.setType(s,o),t.setType(n.captures,JGO.CLEAR),r&&t.setMark(s,JGO.MARK.CIRCLE)):ERROR=n.error,n.success}function sgfSetup(t,e,i){var r={AB:JGO.BLACK,AW:JGO.WHITE,AE:JGO.CLEAR};return t.setType(explodeSGFList(i),r[e]),!0}function sgfMarker(t,e,i){var r={TW:JGO.MARK.WHITE_TERRITORY,TB:JGO.MARK.BLACK_TERRITORY,CR:JGO.MARK.CIRCLE,TR:JGO.MARK.TRIANGLE,MA:JGO.MARK.CROSS,SQ:JGO.MARK.SQUARE};return t.setMark(explodeSGFList(i),r[e]),!0}function sgfComment(t,e,i){return t.info.comment=i[0],!0}function sgfHandicap(t,e,i){return t.info.handicap=i[0],!0}function sgfLabel(t,e,i){for(var r=0;r<i.length;r++){var s=i[r].split(":");t.setMark(new Coordinate(s[0]),s[1])}return!0}function sgfInfo(t,e,i){var r=fieldMap[e];return t.info[r]=i[0],!0}var SGFProperties={B:sgfMove,W:sgfMove,AB:sgfSetup,AW:sgfSetup,AE:sgfSetup,C:sgfComment,LB:sgfLabel,HA:sgfHandicap,TW:sgfMarker,TB:sgfMarker,CR:sgfMarker,TR:sgfMarker,MA:sgfMarker,SQ:sgfMarker,AN:sgfInfo,CP:sgfInfo,DT:sgfInfo,EV:sgfInfo,GN:sgfInfo,OT:sgfInfo,RO:sgfInfo,RE:sgfInfo,RU:sgfInfo,SO:sgfInfo,TM:sgfInfo,PC:sgfInfo,PB:sgfInfo,PW:sgfInfo,BR:sgfInfo,WR:sgfInfo,BT:sgfInfo,WT:sgfInfo};function parseSGF(t){var e,i,r,s,o=!1,n=-1,h=[];if(3==="a~b".split(/(~)/).length)e=t.split(/([\[\]\(\);])/);else{var a=0;for(e=[],i=0,r=t.length;i<r;++i)-1!=="[]();".indexOf(t.charAt(i))&&(a<i&&e.push(t.substring(a,i)),e.push(t.charAt(i)),a=i+1);a<i&&e.push(t.substr(a,i))}for(i=0,r=e.length;i<r;++i)s=e[i],-1==n?"["==(s=s.replace(/^\s+|\s+$/g,""))?n=i:""!==s&&h.push(s):"]"!=s?o="\\"==s.charAt(s.length-1):o?o=!1:(h.push(e.slice(n,i+1).join("").replace(/\\\]/g,"]")),n=-1);if(0===h.length)return ERROR="SGF was empty!",!1;if("("!=h[0]||";"!=h[1]||")"!=h[h.length-1])return ERROR="SGF did not start with '(;' or end with ')'!",!1;e=h,h=[];var d,c="";for(i=0,r=e.length;i<r;++i)if("("==(s=e[i])||")"==s){if(d){if(""!==c&&0===d[c].length)return ERROR="Missing property value at "+s+"!",!1;h.push(d),d=void 0}h.push(s)}else if(";"==s){if(d){if(""!==c&&0===d[c].length)return ERROR="Missing property value at "+s+"!",!1;h.push(d)}d={},c=""}else if(0!==s.indexOf("[")){if(""!==c&&0===d[c].length)return ERROR="Missing property value at "+s+"!",!1;if(s in d)return ERROR="Duplicate property identifier "+s+"!",!1;d[c=s]=[]}else{if(""===c)return ERROR="Missing property identifier at "+s+"!",!1;d[c].push(s.substring(1,s.length-1))}var g,f=[],p={sequence:[],leaves:[]};for(i=1,r=(e=h).length;i<r-1;++i)if("("==(s=e[i])){if(0===p.sequence.length)return ERROR="SGF contains a game tree without a sequence!",!1;f.push(p),p={sequence:[],leaves:[]}}else if(")"==s){if(0===p.sequence.length)return ERROR="SGF contains a game tree without a sequence!",!1;g=p,(p=f.pop()).leaves.push(g)}else p.sequence.push(s);return f.length>0?(ERROR="Invalid number of parentheses in the SGF!",!1):p}function recurseRecord(t,e,i){for(var r=0;r<e.sequence.length;r++){var s=e.sequence[r],o=t.createNode(!0);for(var n in s)if(s.hasOwnProperty(n)){if(!(n in SGFProperties))continue;if(!SGFProperties[n](o,n,s[n],i))return ERROR="Error while parsing node "+n+": "+ERROR,!1}}for(r=0;r<e.leaves.length;r++){var h,a=e.leaves[r];if(h=t.createSnapshot(),!recurseRecord(t,a,i))return!1;t.restoreSnapshot(h)}return!0}function gameTreeToRecord(t,e){var i,r=t.sequence[0],s=19,o=19;if("SZ"in r){var n=r.SZ[0];-1!=n.indexOf(":")?(s=parseInt(n.substring(0,n.indexOf(":"))),o=parseInt(n.substr(n.indexOf(":")+1))):s=o=parseInt(n)}return!!recurseRecord(i=new Record(s,o),t,e)&&(i.first(),i)}function load(t,e){var i=parseSGF(t);if(!1===i)return ERROR;if(0===i.sequence.length){var r=[];if(0===i.leaves.length)return"Empty game tree!";for(var s=0;s<i.leaves.length;s++){var o=gameTreeToRecord(i,e);if(!o)return ERROR;r.push(o)}return r}return gameTreeToRecord(i,e)}const sgf={load:load};function parseMarkup(t){for(var e=t.split("\n"),i=[],r=0,s=e.length;r<s;++r){for(var o=[],n=e[r],h=0,a=n.length;h<a;++h)switch(n[h]){case".":o.push({type:JGO.CLEAR});break;case"o":o.push({type:JGO.WHITE});break;case"x":o.push({type:JGO.BLACK});break;case" ":break;default:if(!o.length)break;o[o.length-1].mark?o[o.length-1].mark+=n[h]:o[o.length-1].mark=n[h]}o.length&&i.push(o)}return i}function process(JGO,div){var style,width,height,TL,BR;if(style=div.getAttribute("data-jgostyle")?eval(div.getAttribute("data-jgostyle")):JGO.BOARD.medium,div.getAttribute("data-jgosize")){var size=div.getAttribute("data-jgosize");-1!=size.indexOf("x")?(width=parseInt(size.substring(0,size.indexOf("x"))),height=parseInt(size.substr(size.indexOf("x")+1))):width=height=parseInt(size)}var data=parseMarkup(div.innerHTML);if(div.innerHTML="",!width){if(!data.length)return;height=data.length,width=data[0].length}var jboard=new JGO.Board(width,height),jsetup=new JGO.Setup(jboard,style);if(div.getAttribute("data-jgoview")){var tup=div.getAttribute("data-jgoview").split("-");TL=jboard.getCoordinate(tup[0]),BR=jboard.getCoordinate(tup[1])}else TL=new JGO.Coordinate(0,0),BR=new JGO.Coordinate(width-1,height-1);jsetup.view(TL.i,TL.j,width-TL.i,height-TL.j);var c=new JGO.Coordinate;for(c.j=TL.j;c.j<=BR.j;++c.j)for(c.i=TL.i;c.i<=BR.i;++c.i){var elem=data[c.j-TL.j][c.i-TL.i];jboard.setType(c,elem.type),elem.mark&&jboard.setMark(c,elem.mark)}jsetup.create(div)}function init(t,e){for(var i=t.querySelectorAll("div.jgoboard"),r=0,s=i.length;r<s;++r)process(e,i[r])}const auto={init:init};JGO.Coordinate=Coordinate,JGO.Canvas=Canvas,JGO.Node=Node,JGO.Notifier=Notifier,JGO.Record=Record,JGO.Setup=Setup,JGO.Stones=Stones,JGO.Board=Board,JGO.util=util,JGO.sgf=sgf,JGO.auto=auto,"undefined"!=typeof window&&(window.JGO=JGO);export{Board,Canvas,Coordinate,Node,Notifier,Record,Setup,Stones,auto,JGO as default,sgf,util};
//# sourceMappingURL=jgoboard.min.js.map
